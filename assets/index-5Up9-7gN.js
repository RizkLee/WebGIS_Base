import{_ as un,r as Pt,o as fn,f as gn,c as ns,a as N,b as _n,g as ui,h as ve,v as fi,t as gi,n as re,w as mn,T as yn,d as rs,e as pn}from"./index-BcHESiCF.js";import{B as xn,u as kt,l as pt,E as Dt,b as We,c as tt,e as Cn,h as ye,i as ot,j as pe,m as Sn,k as Fn,n as En,o as Wt,p as Ps,q as wn,r as Oi,t as Rs,s as ue,v as Xt,w as si,x as nt,y as Tn,z as xe,A as fe,C as wt,D as et,G as Ve,H as Ue,I as xt,J as Ze,K as Ke,L as He,N as Ct,O as qe,P as vs,Q as he,R as O,T as Ls,U as Zt,W as Je,X as In,Y as Pn,$ as ks,a0 as Rn,a1 as vn,a2 as Ln,a3 as Ms,a4 as kn,a5 as Mn,a6 as Ti,a7 as Ds,a8 as Dn,a9 as Ai,aa as Ni,ab as it,ac as Gn,ad as bn,ae as On,af as An,ag as Nn,ah as Ii,ai as Pi,aj as Gs,ak as bs,al as Wn,am as Kt,an as Bn,ao as Os,ap as Be,aq as jn,ar as Yn,as as rt,at as Ri,au as Xn,av as Vn,aw as Un,ax as As,ay as Ht,az as Zn,aA as Kn,aB as ze,aC as Hn,aD as dt,aE as qn,aF as Bt,aG as ge,aH as Ce,aI as vi,aJ as Jn,aK as zn,aL as $n,aM as Qn,aN as Se,aO as tr,aP as vt,aQ as er,aR as ir,aS as sr,aT as oe,aU as nr,aV as rr,aW as os,aX as $e,aY as or,aZ as je,a_ as ar,a$ as lr,b0 as Li,b1 as hr,b2 as Le,b3 as Nt,b4 as cr,b5 as as,b6 as ls,b7 as Ns,b8 as dr,b9 as ur,ba as Wi,bb as fr,bc as K,bd as gr,be as _r,bf as mr,bg as yr,bh as qt,bi as pr,bj as hs,bk as Bi,bl as Ws,bm as X,bn as Mt,bo as xr,bp as ki,bq as Bs,br as Cr,bs as Q,bt as Sr,bu as U,bv as Qe,bw as cs,bx as Mi,by as ji,bz as Fr,bA as Er,bB as js,bC as st,bD as _e,bE as Ys,bF as wr,bG as Tr,bH as Ir,bI as ds,bJ as Pr,bK as Rr,bL as vr,bM as Lr,bN as kr,bO as le,bP as Ye,bQ as Xe,d as Mr,Z as Dr,S as Gr,F as br,M as Or,f as ae,V as Ar,g as Nr,a as Wr,bR as Br,bS as jr,_ as Yr}from"./ZoomToExtent-DoNKJGmy.js";class H extends xn{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new H(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(kt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=pt(t,Dt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Xr(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Xr(l){if(typeof l=="function")return l;let t;return Array.isArray(l)?t=l:(We(typeof l.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[l]),function(){return t}}function ti(l,t,e,i,s,n,r){let o,a;const c=(e-t)/i;if(c===1)o=t;else if(c===2)o=t,a=s;else if(c!==0){let h=l[t],u=l[t+1],d=0;const f=[0];for(let m=t+i;m<e;m+=i){const y=l[m],p=l[m+1];d+=Math.sqrt((y-h)*(y-h)+(p-u)*(p-u)),f.push(d),h=y,u=p}const g=s*d,_=Cn(f,g);_<0?(a=(g-f[-_-2])/(f[-_-1]-f[-_-2]),o=t+(-_-2)*i):o=t+_*i}r=r>1?r:2,n=n||new Array(r);for(let h=0;h<r;++h)n[h]=o===void 0?NaN:a===void 0?l[o+h]:tt(l[o+h],l[o+i+h],a);return n}function Di(l,t,e,i,s,n){if(e==t)return null;let r;if(s<l[t+i-1])return n?(r=l.slice(t,t+i),r[i-1]=s,r):null;if(l[e-1]<s)return n?(r=l.slice(e-i,e),r[i-1]=s,r):null;if(s==l[t+i-1])return l.slice(t,t+i);let o=t/i,a=e/i;for(;o<a;){const d=o+a>>1;s<l[(d+1)*i-1]?a=d:o=d+1}const c=l[o*i-1];if(s==c)return l.slice((o-1)*i,(o-1)*i+i);const h=l[(o+1)*i-1],u=(s-c)/(h-c);r=[];for(let d=0;d<i-1;++d)r.push(tt(l[(o-1)*i+d],l[o*i+d],u));return r.push(s),r}function Vr(l,t,e,i,s,n,r){if(r)return Di(l,t,e[e.length-1],i,s,n);let o;if(s<l[i-1])return n?(o=l.slice(0,i),o[i-1]=s,o):null;if(l[l.length-1]<s)return n?(o=l.slice(l.length-i),o[i-1]=s,o):null;for(let a=0,c=e.length;a<c;++a){const h=e[a];if(t!=h){if(s<l[t+i-1])return null;if(s<=l[h-1])return Di(l,t,h,i,s,!1);t=h}}return null}function Yi(l,t,e,i){let s=l[t],n=l[t+1],r=0;for(let o=t+i;o<e;o+=i){const a=l[o],c=l[o+1];r+=Math.sqrt((a-s)*(a-s)+(c-n)*(c-n)),s=a,n=c}return r}class at extends ye{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){ot(this.flatCoordinates,t),this.changed()}clone(){const t=new at(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<pe(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Sn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Fn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,s))}forEachSegment(t){return En(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Di(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Wt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return ti(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return Yi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Ps(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new at(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return wn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Oi(this.flatCoordinates,0,t,this.stride),this.changed()}}class Xs{drawCustom(t,e,i,s,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class Ur extends Xs{constructor(t,e,i,s,n,r,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?Rs(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=n,this.squaredTolerance_=r,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=ue()}drawImages_(t,e,i,s){if(!this.image_)return;const n=Xt(t,e,i,s,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.tmpLocalTransform_,a=r.globalAlpha;this.imageOpacity_!=1&&(r.globalAlpha=a*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let h=0,u=n.length;h<u;h+=2){const d=n[h]-this.imageAnchorX_,f=n[h+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,_=f+this.imageAnchorY_;si(o,g,_,1,1,c,-g,-_),r.save(),r.transform.apply(r,o),r.translate(g,_),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.restore()}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(r.globalAlpha=a)}drawText_(t,e,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const n=Xt(t,e,i,s,this.transform_,this.pixelCoordinates_),r=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=s){const a=n[e]+this.textOffsetX_,c=n[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(r.save(),r.translate(a-this.textOffsetX_,c-this.textOffsetY_),r.rotate(o),r.translate(this.textOffsetX_,this.textOffsetY_),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.restore()):(this.textStrokeState_&&r.strokeText(this.text_,a,c),this.textFillState_&&r.fillText(this.text_,a,c))}}moveToLineTo_(t,e,i,s,n){const r=this.context_,o=Xt(t,e,i,s,this.transform_,this.pixelCoordinates_);r.moveTo(o[0],o[1]);let a=o.length;n&&(a-=2);for(let c=2;c<a;c+=2)r.lineTo(o[c],o[c+1]);return n&&r.closePath(),i}drawRings_(t,e,i,s){for(let n=0,r=i.length;n<r;++n)e=this.moveToLineTo_(t,e,i[n],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!nt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Tn(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],n=Math.sqrt(i*i+s*s),r=this.context_;r.beginPath(),r.arc(e[0],e[1],n,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,s=e.length;i<s;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!nt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(nt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=t.getFlatCoordinates();let n=0;const r=t.getEnds(),o=t.getStride();i.beginPath();for(let a=0,c=r.length;a<c;++a)n=this.moveToLineTo_(s,n,r[a],o,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!nt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!nt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const n=t.getEndss(),r=t.getStride();e.beginPath();for(let o=0,a=n.length;o<a;++o){const c=n[o];s=this.drawRings_(i,s,c,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),xe(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:fe;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:wt(i||et)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),s=e.getLineCap(),n=e.getLineDash(),r=e.getLineDashOffset(),o=e.getLineJoin(),a=e.getWidth(),c=e.getMiterLimit(),h=n||xt;this.strokeState_={lineCap:s!==void 0?s:Ze,lineDash:this.pixelRatio_===1?h:h.map(u=>u*this.pixelRatio_),lineDashOffset:(r||Ct)*this.pixelRatio_,lineJoin:o!==void 0?o:Ue,lineWidth:(a!==void 0?a:He)*this.pixelRatio_,miterLimit:c!==void 0?c:Ve,strokeStyle:wt(i||Ke)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const r=t.getScaleArray();this.imageScale_=[r[0]*this.pixelRatio_/i,r[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const f=e.getColor();this.textFillState_={fillStyle:wt(f||et)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),g=i.getLineCap(),_=i.getLineDash(),m=i.getLineDashOffset(),y=i.getLineJoin(),p=i.getWidth(),C=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:Ze,lineDash:_||xt,lineDashOffset:m||Ct,lineJoin:y!==void 0?y:Ue,lineWidth:p!==void 0?p:He,miterLimit:C!==void 0?C:Ve,strokeStyle:wt(f||Ke)}}const s=t.getFont(),n=t.getOffsetX(),r=t.getOffsetY(),o=t.getRotateWithView(),a=t.getRotation(),c=t.getScaleArray(),h=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:s!==void 0?s:vs,textAlign:u!==void 0?u:fe,textBaseline:d!==void 0?d:qe},this.text_=h!==void 0?Array.isArray(h)?h.reduce((f,g,_)=>f+=_%2?" ":g,""):h:"",this.textOffsetX_=n!==void 0?this.pixelRatio_*n:0,this.textOffsetY_=r!==void 0?this.pixelRatio_*r:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=a!==void 0?a:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}const Zr=.5,Vs={Point:to,LineString:zr,Polygon:io,MultiPoint:eo,MultiLineString:$r,MultiPolygon:Qr,GeometryCollection:Jr,Circle:Hr};function Kr(l,t){return parseInt(O(l),10)-parseInt(O(t),10)}function us(l,t){const e=Us(l,t);return e*e}function Us(l,t){return Zr*l/t}function Hr(l,t,e,i,s){const n=e.getFill(),r=e.getStroke();if(n||r){const a=l.getBuilder(e.getZIndex(),"Circle");a.setFillStrokeStyle(n,r),a.drawCircle(t,i,s)}const o=e.getText();if(o&&o.getText()){const a=l.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}}function fs(l,t,e,i,s,n,r,o){const a=[],c=e.getImage();if(c){let d=!0;const f=c.getImageState();f==he.LOADED||f==he.ERROR?d=!1:f==he.IDLE&&c.load(),d&&a.push(c.ready())}const h=e.getFill();h&&h.loading()&&a.push(h.ready());const u=a.length>0;return u&&Promise.all(a).then(()=>s(null)),qr(l,t,e,i,n,r,o),u}function qr(l,t,e,i,s,n,r){const o=e.getGeometryFunction()(t);if(!o)return;const a=o.simplifyTransformed(i,s);if(e.getRenderer())Zs(l,a,e,t,r);else{const h=Vs[a.getType()];h(l,a,e,t,r,n)}}function Zs(l,t,e,i,s){if(t.getType()=="GeometryCollection"){const r=t.getGeometries();for(let o=0,a=r.length;o<a;++o)Zs(l,r[o],e,i,s);return}l.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),s)}function Jr(l,t,e,i,s,n){const r=t.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o){const c=Vs[r[o].getType()];c(l,r[o],e,i,s,n)}}function zr(l,t,e,i,s){const n=e.getStroke();if(n){const o=l.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,n),o.drawLineString(t,i,s)}const r=e.getText();if(r&&r.getText()){const o=l.getBuilder(e.getZIndex(),"Text");o.setTextStyle(r),o.drawText(t,i,s)}}function $r(l,t,e,i,s){const n=e.getStroke();if(n){const o=l.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,n),o.drawMultiLineString(t,i,s)}const r=e.getText();if(r&&r.getText()){const o=l.getBuilder(e.getZIndex(),"Text");o.setTextStyle(r),o.drawText(t,i,s)}}function Qr(l,t,e,i,s){const n=e.getFill(),r=e.getStroke();if(r||n){const a=l.getBuilder(e.getZIndex(),"Polygon");a.setFillStrokeStyle(n,r),a.drawMultiPolygon(t,i,s)}const o=e.getText();if(o&&o.getText()){const a=l.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,s)}}function to(l,t,e,i,s,n){const r=e.getImage(),o=e.getText(),a=o&&o.getText(),c=n&&r&&a?{}:void 0;if(r){if(r.getImageState()!=he.LOADED)return;const h=l.getBuilder(e.getZIndex(),"Image");h.setImageStyle(r,c),h.drawPoint(t,i,s)}if(a){const h=l.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,c),h.drawText(t,i,s)}}function eo(l,t,e,i,s,n){const r=e.getImage(),o=r&&r.getOpacity()!==0,a=e.getText(),c=a&&a.getText(),h=n&&o&&c?{}:void 0;if(o){if(r.getImageState()!=he.LOADED)return;const u=l.getBuilder(e.getZIndex(),"Image");u.setImageStyle(r,h),u.drawMultiPoint(t,i,s)}if(c){const u=l.getBuilder(e.getZIndex(),"Text");u.setTextStyle(a,h),u.drawText(t,i,s)}}function io(l,t,e,i,s){const n=e.getFill(),r=e.getStroke();if(n||r){const a=l.getBuilder(e.getZIndex(),"Polygon");a.setFillStrokeStyle(n,r),a.drawPolygon(t,i,s)}const o=e.getText();if(o&&o.getText()){const a=l.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,s)}}let so=!1;function no(l,t,e,i,s,n,r){const o=new XMLHttpRequest;o.open("GET",typeof l=="function"?l(e,i,s):l,!0),t.getType()=="arraybuffer"&&(o.responseType="arraybuffer"),o.withCredentials=so,o.onload=function(a){if(!o.status||o.status>=200&&o.status<300){const c=t.getType();try{let h;c=="text"||c=="json"?h=o.responseText:c=="xml"?h=o.responseXML||o.responseText:c=="arraybuffer"&&(h=o.response),h?n(t.readFeatures(h,{extent:e,featureProjection:s}),t.readProjection(h)):r()}catch{r()}}else r()},o.onerror=r,o.send()}function gs(l,t){return function(e,i,s,n,r){no(l,t,e,i,s,(o,a)=>{this.addFeatures(o),n!==void 0&&n(o)},()=>{this.changed(),r!==void 0&&r()})}}function ro(l,t){return[[-1/0,-1/0,1/0,1/0]]}function Ks(l,t,e,i){const s=[];let n=Zt();for(let r=0,o=e.length;r<o;++r){const a=e[r];n=Ls(l,t,a[0],i),s.push((n[0]+n[2])/2,(n[1]+n[3])/2),t=a[a.length-1]}return s}class ni extends ye{constructor(t,e,i){super(),i!==void 0&&e===void 0?this.setFlatCoordinates(i,t):(e=e||0,this.setCenterAndRadius(t,e,i))}clone(){const t=new ni(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){const n=this.flatCoordinates,r=t-n[0],o=e-n[1],a=r*r+o*o;if(a<s){if(a===0)for(let c=0;c<this.stride;++c)i[c]=n[c];else{const c=this.getRadius()/Math.sqrt(a);i[0]=n[0]+c*r,i[1]=n[1]+c*o;for(let h=2;h<this.stride;++h)i[h]=n[h]}return i.length=this.stride,a}return s}containsXY(t,e){const i=this.flatCoordinates,s=t-i[0],n=e-i[1];return s*s+n*n<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,i=e[this.stride]-e[0];return Je(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){const e=this.getExtent();if(nt(t,e)){const i=this.getCenter();return t[0]<=i[0]&&t[2]>=i[0]||t[1]<=i[1]&&t[3]>=i[1]?!0:In(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],s=t.slice();s[e]=s[0]+i;for(let n=1;n<e;++n)s[e+n]=t[n];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let n=Pn(s,0,t,this.stride);s[n++]=s[0]+e;for(let r=1,o=this.stride;r<o;++r)s[n++]=s[r];s.length=n,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const i=this.getCenter(),s=this.getStride();this.setCenter(ks(i,0,i.length,s,t,e,i)),this.changed()}}ni.prototype.transform;class me extends Rn{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(kt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,i=t.length;e<i;++e)this.changeEventsKeys_.push(pt(t[e],Dt.CHANGE,this.changed,this))}clone(){const t=new me(_i(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<pe(this.getExtent(),t,e))return s;const n=this.geometries_;for(let r=0,o=n.length;r<o;++r)s=n[r].closestPointXY(t,e,i,s);return s}containsXY(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)if(i[s].containsXY(t,e))return!0;return!1}computeExtent(t){vn(t);const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)Ln(t,e[i].getExtent());return t}getGeometries(){return _i(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let s=!1;for(let n=0,r=i.length;n<r;++n){const o=i[n],a=o.getSimplifiedGeometry(t);e.push(a),a!==o&&(s=!0)}return s?new me(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)i[s].rotate(t,e);this.changed()}scale(t,e,i){i||(i=Ms(this.getExtent()));const s=this.geometries_;for(let n=0,r=s.length;n<r;++n)s[n].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(_i(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)i[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function _i(l){return l.map(t=>t.clone())}class Gt extends ye{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const s=t,n=[],r=[];for(let a=0,c=s.length;a<c;++a){const h=s[a];ot(n,h.getFlatCoordinates()),r.push(n.length)}const o=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(o,n),this.ends_=r}}appendLineString(t){ot(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Gt(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<pe(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(kn(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Mn(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,s))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,Vr(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return Ti(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new at(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,s=[];let n=0;for(let r=0,o=e.length;r<o;++r){const a=e[r],c=new at(t.slice(n,a),i);s.push(c),n=a}return s}getLength(){const t=this.ends_;let e=0,i=0;for(let s=0,n=t.length;s<n;++s)i+=Yi(this.flatCoordinates,e,t[s],this.stride),e=t[s];return i}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const s=this.ends_,n=this.stride;for(let r=0,o=s.length;r<o;++r){const a=s[r],c=ti(e,i,a,n,.5);ot(t,c),i=a}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Ds(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new Gt(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return Dn(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Ai(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class Jt extends ye{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){ot(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new Jt(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<pe(this.getExtent(),t,e))return s;const n=this.flatCoordinates,r=this.stride;for(let o=0,a=n.length;o<a;o+=r){const c=Ni(t,e,n[o],n[o+1]);if(c<s){s=c;for(let h=0;h<r;++h)i[h]=n[o+h];i.length=r}}return s}getCoordinates(){return Wt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new it(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,s=[];for(let n=0,r=t.length;n<r;n+=i){const o=new it(t.slice(n,n+i),e);s.push(o)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let s=0,n=e.length;s<n;s+=i){const r=e[s],o=e[s+1];if(Gn(t,r,o))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Oi(this.flatCoordinates,0,t,this.stride),this.changed()}}class bt extends ye{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const s=t,n=[],r=[];for(let o=0,a=s.length;o<a;++o){const c=s[o],h=n.length,u=c.getEnds();for(let d=0,f=u.length;d<f;++d)u[d]+=h;ot(n,c.getFlatCoordinates()),r.push(u)}e=s.length===0?this.getLayout():s[0].getLayout(),t=n,i=r}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;ot(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,n=e.length;s<n;++s)e[s]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const i=new bt(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,s){return s<pe(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(bn(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),On(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return An(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Nn(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Ii(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Pi(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Ks(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Gs(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Jt(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;bs(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ii(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Wn(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new bt(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const n=this.endss_[t-1];e=n[n.length-1]}const i=this.endss_[t].slice(),s=i[i.length-1];if(e!==0)for(let n=0,r=i.length;n<r;++n)i[n]-=e;return new Kt(this.flatCoordinates.slice(e,s),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,s=[];let n=0;for(let r=0,o=i.length;r<o;++r){const a=i[r].slice(),c=a[a.length-1];if(n!==0)for(let u=0,d=a.length;u<d;++u)a[u]-=n;const h=new Kt(e.slice(n,c),t,a);s.push(h),n=c}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return Bn(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=Os(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const s=i[i.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const _s=ue();class q{constructor(t,e,i,s,n,r){this.styleFunction,this.extent_,this.id_=r,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=n,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Be(this.flatCoordinates_):Ls(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Ms(this.getExtent());this.flatInteriorPoints_=jn(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Yn(this.flatCoordinates_,this.ends_),e=Ks(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Gs(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=ti(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let s=0,n=i.length;s<n;++s){const r=i[s],o=ti(t,e,r,2,.5);ot(this.flatMidpoints_,o),e=r}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=rt(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const s=Ri(i)/Ri(e);si(_s,i[0],i[3],s,-s,0,0,0),Xt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,_s,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new q(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Xn((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":i.length=Ps(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),s=[i.length];break;case"MultiLineString":s=[],i.length=Ds(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,s);break;case"Polygon":s=[],i.length=Vn(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,s);break}return s&&(this.simplifiedGeometry_=new q(this.type_,i,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}q.prototype.getFlatCoordinates=q.prototype.getOrientedFlatCoordinates;class ei{constructor(t){this.rbush_=new Un(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[O(e)]=i}load(t,e){const i=new Array(e.length);for(let s=0,n=e.length;s<n;s++){const r=t[s],o=e[s],a={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:o};i[s]=a,this.items_[O(o)]=a}this.rbush_.load(i)}remove(t){const e=O(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[O(e)],s=[i.minX,i.minY,i.maxX,i.maxY];As(s,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let s=0,n=t.length;s<n;s++)if(i=e(t[s]),i)return i;return i}isEmpty(){return Ht(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Je(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const V={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class St extends Ce{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class ce extends Zn{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Kn,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(We(this.format_,"`format` must be set when `url` is set"),this.loader_=gs(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:ro;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new ei:null,this.loadedExtentsRtree_=new ei,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,s;Array.isArray(t.features)?s=t.features:t.features&&(i=t.features,s=i.getArray()),!e&&i===void 0&&(i=new ze(s)),s!==void 0&&this.addFeaturesInternal(s),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=O(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new St(V.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof q||(this.featureChangeKeys_[t]=[pt(e,Dt.CHANGE,this.handleFeatureChange_,this),pt(e,Hn.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const s=String(e.getId());if(!(s in this.idIndex_))this.idIndex_[s]=e;else if(e instanceof q){const n=this.idIndex_[s];n instanceof q?Array.isArray(n)?n.push(e):this.idIndex_[s]=[n,e]:i=!1}else i=!1}return i&&(We(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],s=[];for(let n=0,r=t.length;n<r;n++){const o=t[n],a=O(o);this.addToIndex_(a,o)&&i.push(o)}for(let n=0,r=i.length;n<r;n++){const o=i[n],a=O(o);this.setupChangeEvents_(a,o);const c=o.getGeometry();if(c){const h=c.getExtent();e.push(h),s.push(o)}else this.nullGeometryFeatures_[a]=o}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(V.ADDFEATURE))for(let n=0,r=i.length;n<r;n++)this.dispatchEvent(new St(V.ADDFEATURE,i[n]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(V.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(V.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(dt.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(dt.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(kt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new St(V.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(s){const n=s.getGeometry();if(n instanceof q||n.intersectsCoordinate(t))return e(s)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const s=i.getGeometry();if(s instanceof q||s.intersectsExtent(t)){const n=e(i);if(n)return n}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Ht(this.nullGeometryFeatures_)||ot(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=qn(t,e);return[].concat(...s.map(n=>this.featuresRtree_.getInExtent(n)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],s=t[1];let n=null;const r=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0];return e=e||ge,this.featuresRtree_.forEachInExtent(a,function(c){if(e(c)){const h=c.getGeometry(),u=o;if(o=h instanceof q?0:h.closestPointXY(i,s,r,o),o<u){n=c;const d=Math.sqrt(o);a[0]=i-d,a[1]=s-d,a[2]=i+d,a[3]=s+d}}}),n}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=O(e),s=e.getGeometry();if(!s)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const r=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(r,e)):this.featuresRtree_&&this.featuresRtree_.update(r,e)}const n=e.getId();if(n!==void 0){const r=n.toString();this.idIndex_[r]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[r]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new St(V.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:O(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Ht(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const s=this.loadedExtentsRtree_,n=this.strategy_(t,e,i);for(let r=0,o=n.length;r<o;++r){const a=n[r];s.forEachInExtent(a,function(h){return Bt(h.extent,a)})||(++this.loadingExtentsCount_,this.dispatchEvent(new St(V.FEATURESLOADSTART)),this.loader_.call(this,a,e,i,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new St(V.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new St(V.FEATURESLOADERROR))}),s.insert(a,{extent:a.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,i=e.forEachInExtent(t,function(s){if(As(s.extent,t))return s});i&&e.remove(i)}removeFeatures(t){let e=!1;for(let i=0,s=t.length;i<s;++i)e=this.removeFeatureInternal(t[i])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=O(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[e]?.forEach(kt),delete this.featureChangeKeys_[e];const s=t.getId();if(s!==void 0){const n=s.toString(),r=this.idIndex_[n];r===t?delete this.idIndex_[n]:Array.isArray(r)&&(r.splice(r.indexOf(t),1),r.length===1&&(this.idIndex_[n]=r[0]))}return delete this.uidIndex_[e],this.hasListener(V.REMOVEFEATURE)&&this.dispatchEvent(new St(V.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){We(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(gs(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}const I={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ke=[I.FILL],Tt=[I.STROKE],Lt=[I.BEGIN_PATH],ms=[I.CLOSE_PATH];class Fe extends Xs{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,n=this.coordinates;let r=n.length;for(let o=0,a=t.length;o<a;o+=e)s[0]=t[o],s[1]=t[o+1],vi(i,s)&&(n[r++]=s[0],n[r++]=s[1]);return r}appendFlatLineCoordinates(t,e,i,s,n,r){const o=this.coordinates;let a=o.length;const c=this.getBufferedMaxExtent();r&&(e+=s);let h=t[e],u=t[e+1];const d=this.tmpCoordinate_;let f=!0,g,_,m;for(g=e+s;g<i;g+=s)d[0]=t[g],d[1]=t[g+1],m=Jn(c,d),m!==_?(f&&(o[a++]=h,o[a++]=u,f=!1),o[a++]=d[0],o[a++]=d[1]):m===zn.INTERSECTING?(o[a++]=d[0],o[a++]=d[1],f=!1):f=!0,h=d[0],u=d[1],_=m;return(n&&f||g===e+s)&&(o[a++]=h,o[a++]=u),a}drawCustomCoordinates_(t,e,i,s,n){for(let r=0,o=i.length;r<o;++r){const a=i[r],c=this.appendFlatLineCoordinates(t,e,a,s,!1,!1);n.push(c),e=a}return e}drawCustom(t,e,i,s,n){this.beginGeometry(t,e,n);const r=t.getType(),o=t.getStride(),a=this.coordinates.length;let c,h,u,d,f;switch(r){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),d=[];const g=t.getEndss();f=0;for(let _=0,m=g.length;_<m;++_){const y=[];f=this.drawCustomCoordinates_(c,f,g[_],o,y),d.push(y)}this.instructions.push([I.CUSTOM,a,d,t,i,Pi,n]),this.hitDetectionInstructions.push([I.CUSTOM,a,d,t,s||i,Pi,n]);break;case"Polygon":case"MultiLineString":u=[],c=r=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),f=this.drawCustomCoordinates_(c,0,t.getEnds(),o,u),this.instructions.push([I.CUSTOM,a,u,t,i,Ti,n]),this.hitDetectionInstructions.push([I.CUSTOM,a,u,t,s||i,Ti,n]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(c,0,c.length,o,!1,!1),this.instructions.push([I.CUSTOM,a,h,t,i,Wt,n]),this.hitDetectionInstructions.push([I.CUSTOM,a,h,t,s||i,Wt,n]);break;case"MultiPoint":c=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(c,o),h>a&&(this.instructions.push([I.CUSTOM,a,h,t,i,Wt,n]),this.hitDetectionInstructions.push([I.CUSTOM,a,h,t,s||i,Wt,n]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),h=this.coordinates.length,this.instructions.push([I.CUSTOM,a,h,t,i,void 0,n]),this.hitDetectionInstructions.push([I.CUSTOM,a,h,t,s||i,void 0,n]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[I.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[I.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let s,n,r=-1;for(e=0;e<i;++e)s=t[e],n=s[0],n==I.END_GEOMETRY?r=e:n==I.BEGIN_GEOMETRY&&(s[2]=e,$n(this.hitDetectionInstructions,r,e),r=-1)}fillStyleToState(t,e={}){if(t){const i=t.getColor();e.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,e.fillStyle=wt(i||et)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const i=t.getColor();e.strokeStyle=wt(i||Ke);const s=t.getLineCap();e.lineCap=s!==void 0?s:Ze;const n=t.getLineDash();e.lineDash=n?n.slice():xt;const r=t.getLineDashOffset();e.lineDashOffset=r||Ct;const o=t.getLineJoin();e.lineJoin=o!==void 0?o:Ue;const a=t.getWidth();e.lineWidth=a!==void 0?a:He;const c=t.getMiterLimit();e.miterLimit=c!==void 0?c:Ve,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const i=this.state;this.fillStyleToState(t,i),this.strokeStyleToState(e,i)}createFill(t){const e=t.fillStyle,i=[I.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[I.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,s=t.lineCap,n=t.lineDash,r=t.lineDashOffset,o=t.lineJoin,a=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=s||n!=t.currentLineDash&&!xe(t.currentLineDash,n)||t.currentLineDashOffset!=r||t.currentLineJoin!=o||t.currentLineWidth!=a||t.currentMiterLimit!=c)&&(e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=n,t.currentLineDashOffset=r,t.currentLineJoin=o,t.currentLineWidth=a,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[I.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Qn(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Se(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class oo extends Fe{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!vi(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(s,n);this.instructions.push([I.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([I.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),n=[];for(let a=0,c=s.length;a<c;a+=t.getStride())(!this.maxExtent||vi(this.maxExtent,s.slice(a,a+2)))&&n.push(s[a],s[a+1]);const r=this.coordinates.length,o=this.appendFlatPointCoordinates(n,2);this.instructions.push([I.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([I.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),s=t.getSize(),n=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=n[0],this.originY_=n[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class ao extends Fe{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){const n=this.coordinates.length,r=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),o=[I.MOVE_TO_LINE_TO,n,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e,i){const s=this.state,n=s.strokeStyle,r=s.lineWidth;if(n===void 0||r===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,xt,Ct],Lt);const o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(Tt),this.endGeometry(e)}drawMultiLineString(t,e,i){const s=this.state,n=s.strokeStyle,r=s.lineWidth;if(n===void 0||r===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,xt,Ct],Lt);const o=t.getEnds(),a=t.getFlatCoordinates(),c=t.getStride();let h=0;for(let u=0,d=o.length;u<d;++u)h=this.drawFlatCoordinates_(a,h,o[u],c);this.hitDetectionInstructions.push(Tt),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Tt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Tt),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Lt)}}class ys extends Fe{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){const n=this.state,r=n.fillStyle!==void 0,o=n.strokeStyle!==void 0,a=i.length;this.instructions.push(Lt),this.hitDetectionInstructions.push(Lt);for(let c=0;c<a;++c){const h=i[c],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,h,s,!0,!o),f=[I.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),o&&(this.instructions.push(ms),this.hitDetectionInstructions.push(ms)),e=h}return r&&(this.instructions.push(ke),this.hitDetectionInstructions.push(ke)),o&&(this.instructions.push(Tt),this.hitDetectionInstructions.push(Tt)),e}drawCircle(t,e,i){const s=this.state,n=s.fillStyle,r=s.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,et]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,xt,Ct]);const o=t.getFlatCoordinates(),a=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const h=[I.CIRCLE,c];this.instructions.push(Lt,h),this.hitDetectionInstructions.push(Lt,h),s.fillStyle!==void 0&&(this.instructions.push(ke),this.hitDetectionInstructions.push(ke)),s.strokeStyle!==void 0&&(this.instructions.push(Tt),this.hitDetectionInstructions.push(Tt)),this.endGeometry(e)}drawPolygon(t,e,i){const s=this.state,n=s.fillStyle,r=s.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,et]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,xt,Ct]);const o=t.getEnds(),a=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(a,0,o,c),this.endGeometry(e)}drawMultiPolygon(t,e,i){const s=this.state,n=s.fillStyle,r=s.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,et]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,xt,Ct]);const o=t.getEndss(),a=t.getOrientedFlatCoordinates(),c=t.getStride();let h=0;for(let u=0,d=o.length;u<d;++u)h=this.drawFlatCoordinatess_(a,h,o[u],c);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=tr(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;this.updateFillStyle(t,this.createFill),this.updateStrokeStyle(t,this.applyStroke)}}function lo(l,t,e,i,s){const n=[];let r=e,o=0,a=t.slice(e,2);for(;o<l&&r+s<i;){const[c,h]=a.slice(-2),u=t[r+s],d=t[r+s+1],f=Math.sqrt((u-c)*(u-c)+(d-h)*(d-h));if(o+=f,o>=l){const g=(l-o+f)/f,_=tt(c,u,g),m=tt(h,d,g);a.push(_,m),n.push(a),a=[_,m],o==l&&(r+=s),o=0}else if(o<l)a.push(t[r+s],t[r+s+1]),r+=s;else{const g=f-o,_=tt(c,u,g/f),m=tt(h,d,g/f);a.push(_,m),n.push(a),a=[_,m],o=0,r+=s}}return o>0&&n.push(a),n}function ho(l,t,e,i,s){let n=e,r=e,o=0,a=0,c=e,h,u,d,f,g,_,m,y,p,C;for(u=e;u<i;u+=s){const x=t[u],T=t[u+1];g!==void 0&&(p=x-g,C=T-_,f=Math.sqrt(p*p+C*C),m!==void 0&&(a+=d,h=Math.acos((m*p+y*C)/(d*f)),h>l&&(a>o&&(o=a,n=c,r=u),a=0,c=u-s)),d=f,m=p,y=C),g=x,_=T}return a+=f,a>o?[c,u]:[n,r]}const ii={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class co extends Fe{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[et]={fillStyle:et},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const s=this.textFillState_,n=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!s&&!n)return;const o=this.coordinates;let a=o.length;const c=t.getType();let h=null,u=t.getStride();if(r.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!nt(this.maxExtent,t.getExtent()))return;let d;if(h=t.getFlatCoordinates(),c=="LineString")d=[h.length];else if(c=="MultiLineString")d=t.getEnds();else if(c=="Polygon")d=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){const m=t.getEndss();d=[];for(let y=0,p=m.length;y<p;++y)d.push(m[y][0])}this.beginGeometry(t,e,i);const f=r.repeat,g=f?void 0:r.textAlign;let _=0;for(let m=0,y=d.length;m<y;++m){let p;f?p=lo(f*this.resolution,h,_,d[m],u):p=[h.slice(_,d[m])];for(let C=0,x=p.length;C<x;++C){const T=p[C];let P=0,R=T.length;if(g==null){const v=ho(r.maxAngle,T,0,T.length,2);P=v[0],R=v[1]}for(let v=P;v<R;v+=u)o.push(T[v],T[v+1]);const k=o.length;_=d[m],this.drawChars_(a,k),a=k}}this.endGeometry(e)}else{let d=r.overflow?null:[];switch(c){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),u=2;break;case"Polygon":h=t.getFlatInteriorPoint(),r.overflow||d.push(h[2]/this.resolution),u=3;break;case"MultiPolygon":const x=t.getFlatInteriorPoints();h=[];for(let T=0,P=x.length;T<P;T+=3)r.overflow||d.push(x[T+2]/this.resolution),h.push(x[T],x[T+1]);if(h.length===0)return;u=2;break}const f=this.appendFlatPointCoordinates(h,u);if(f===a)return;if(d&&(f-a)/2!==h.length/u){let x=a/2;d=d.filter((T,P)=>{const R=o[(x+P)*2]===h[P*u]&&o[(x+P)*2+1]===h[P*u+1];return R||--x,R})}this.saveTextStates_();const g=r.backgroundFill?this.createFill(this.fillStyleToState(r.backgroundFill)):null,_=r.backgroundStroke?this.createStroke(this.strokeStyleToState(r.backgroundStroke)):null;this.beginGeometry(t,e,i);let m=r.padding;if(m!=vt&&(r.scale[0]<0||r.scale[1]<0)){let x=r.padding[0],T=r.padding[1],P=r.padding[2],R=r.padding[3];r.scale[0]<0&&(T=-T,R=-R),r.scale[1]<0&&(x=-x,P=-P),m=[x,T,P,R]}const y=this.pixelRatio;this.instructions.push([I.DRAW_IMAGE,a,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,m==vt?vt:m.map(function(x){return x*y}),g,_,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const p=1/y,C=g?g.slice(0):null;C&&(C[1]=et),this.hitDetectionInstructions.push([I.DRAW_IMAGE,a,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[p,p],NaN,this.declutterMode_,this.declutterImageWithText_,m,C,_,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?et:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const n=this.textKey_;n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||fe,justify:e.justify,textBaseline:e.textBaseline||qe,scale:e.scale});const r=this.fillKey_;i&&(r in this.fillStates||(this.fillStates[r]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,s=this.textState_,n=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,c=ii[s.textBaseline],h=this.textOffsetY_*a,u=this.text_,d=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([I.DRAW_CHARS,t,e,c,s.overflow,o,s.maxAngle,a,h,n,d*a,u,r,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([I.DRAW_CHARS,t,e,c,s.overflow,o&&et,s.maxAngle,a,h,n,d*a,u,r,1/a,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let i,s,n;if(!t)this.text_="";else{const r=t.getFill();r?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=wt(r.getColor()||et)):(s=null,this.textFillState_=s);const o=t.getStroke();if(!o)n=null,this.textStrokeState_=n;else{n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);const _=o.getLineDash(),m=o.getLineDashOffset(),y=o.getWidth(),p=o.getMiterLimit();n.lineCap=o.getLineCap()||Ze,n.lineDash=_?_.slice():xt,n.lineDashOffset=m===void 0?Ct:m,n.lineJoin=o.getLineJoin()||Ue,n.lineWidth=y===void 0?He:y,n.miterLimit=p===void 0?Ve:p,n.strokeStyle=wt(o.getColor()||Ke)}i=this.textState_;const a=t.getFont()||vs;er(a);const c=t.getScaleArray();i.overflow=t.getOverflow(),i.font=a,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||qe,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||vt,i.scale=c===void 0?[1,1]:c;const h=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),f=t.getKeepUpright(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=h===void 0?0:h,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textKeepUpright_=f===void 0?!0:f,this.textRotation_=g===void 0?0:g,this.strokeKey_=n?(typeof n.strokeStyle=="string"?n.strokeStyle:O(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+O(s.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const uo={Circle:ys,Default:Fe,Image:oo,LineString:ao,Polygon:ys,Text:co};class fo{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const s in i){const n=i[s].finish();t[e][s]=n}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[i];s===void 0&&(s={},this.buildersByZIndex_[i]=s);let n=s[e];if(n===void 0){const r=uo[e];n=new r(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=n}return n}}function go(l,t,e,i,s,n,r,o,a,c,h,u,d=!0){let f=l[t],g=l[t+1],_=0,m=0,y=0,p=0;function C(){_=f,m=g,t+=i,f=l[t],g=l[t+1],p+=y,y=Math.sqrt((f-_)*(f-_)+(g-m)*(g-m))}do C();while(t<e-i&&p+y<n);let x=y===0?0:(n-p)/y;const T=tt(_,f,x),P=tt(m,g,x),R=t-i,k=p,v=n+o*a(c,s,h);for(;t<e-i&&p+y<v;)C();x=y===0?0:(v-p)/y;const A=tt(_,f,x),D=tt(m,g,x);let M=!1;if(d)if(u){const L=[T,P,A,D];ks(L,0,4,2,u,L,L),M=L[0]>L[2]}else M=T>A;const G=Math.PI,S=[],F=R+i===t;t=R,y=0,p=k,f=l[t],g=l[t+1];let w;if(F){C(),w=Math.atan2(g-m,f-_),M&&(w+=w>0?-G:G);const L=(A+T)/2,b=(D+P)/2;return S[0]=[L,b,(v-n)/2,w,s],S}s=s.replace(/\n/g," ");for(let L=0,b=s.length;L<b;){C();let Y=Math.atan2(g-m,f-_);if(M&&(Y+=Y>0?-G:G),w!==void 0){let lt=Y-w;if(lt+=lt>G?-2*G:lt<-G?2*G:0,Math.abs(lt)>r)return null}w=Y;const W=L;let j=0;for(;L<b;++L){const lt=M?b-L-1:L,Te=o*a(c,s[lt],h);if(t+i<e&&p+y<n+j+Te/2)break;j+=Te}if(L===W)continue;const E=M?s.substring(b-W,b-L):s.substring(W,L);x=y===0?0:(n+j/2-p)/y;const $t=tt(_,f,x),Qt=tt(m,g,x);S.push([$t,Qt,j/2,Y,E]),n+=j}return S}const Ot=Zt(),Ft=[],_t=[],mt=[],Et=[];function ps(l){return l[3].declutterBox}const xs=new RegExp("[-----]");function mi(l,t){return t==="start"?t=xs.test(l)?"right":"left":t==="end"&&(t=xs.test(l)?"left":"right"),ii[t]}function _o(l,t,e){return e>0&&l.push(`
`,""),l.push(t,""),l}function mo(l,t,e){return e%2===0&&(l+=t),l}class yo{constructor(t,e,i,s,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=ue(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=n?new ir:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,s){const n=t+e+i+s;if(this.labels_[n])return this.labels_[n];const r=s?this.strokeStates[s]:null,o=i?this.fillStates[i]:null,a=this.textStates[e],c=this.pixelRatio,h=[a.scale[0]*c,a.scale[1]*c],u=a.justify?ii[a.justify]:mi(Array.isArray(t)?t[0]:t,a.textAlign||fe),d=s&&r.lineWidth?r.lineWidth:0,f=Array.isArray(t)?t:String(t).split(`
`).reduce(_o,[]),{width:g,height:_,widths:m,heights:y,lineWidths:p}=sr(a,f),C=g+d,x=[],T=(C+2)*h[0],P=(_+d)*h[1],R={width:T<0?Math.floor(T):Math.ceil(T),height:P<0?Math.floor(P):Math.ceil(P),contextInstructions:x};(h[0]!=1||h[1]!=1)&&x.push("scale",h),s&&(x.push("strokeStyle",r.strokeStyle),x.push("lineWidth",d),x.push("lineCap",r.lineCap),x.push("lineJoin",r.lineJoin),x.push("miterLimit",r.miterLimit),x.push("setLineDash",[r.lineDash]),x.push("lineDashOffset",r.lineDashOffset)),i&&x.push("fillStyle",o.fillStyle),x.push("textBaseline","middle"),x.push("textAlign","center");const k=.5-u;let v=u*C+k*d;const A=[],D=[];let M=0,G=0,S=0,F=0,w;for(let L=0,b=f.length;L<b;L+=2){const Y=f[L];if(Y===`
`){G+=M,M=0,v=u*C+k*d,++F;continue}const W=f[L+1]||a.font;W!==w&&(s&&A.push("font",W),i&&D.push("font",W),w=W),M=Math.max(M,y[S]);const j=[Y,v+k*m[S]+u*(m[S]-p[F]),.5*(d+M)+G];v+=m[S],s&&A.push("strokeText",j),i&&D.push("fillText",j),++S}return Array.prototype.push.apply(x,A),Array.prototype.push.apply(x,D),this.labels_[n]=R,R}replayTextBackground_(t,e,i,s,n,r,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,n),t.lineTo.apply(t,e),r&&(this.alignAndScaleFill_=r[2],t.fillStyle=r[1],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,n,r,o,a,c,h,u,d,f,g,_,m){o*=d[0],a*=d[1];let y=i-o,p=s-a;const C=n+c>t?t-c:n,x=r+h>e?e-h:r,T=g[3]+C*d[0]+g[1],P=g[0]+x*d[1]+g[2],R=y-g[3],k=p-g[0];(_||u!==0)&&(Ft[0]=R,Et[0]=R,Ft[1]=k,_t[1]=k,_t[0]=R+T,mt[0]=_t[0],mt[1]=k+P,Et[1]=mt[1]);let v;return u!==0?(v=si(ue(),i,s,1,1,u,-i,-s),oe(v,Ft),oe(v,_t),oe(v,mt),oe(v,Et),Je(Math.min(Ft[0],_t[0],mt[0],Et[0]),Math.min(Ft[1],_t[1],mt[1],Et[1]),Math.max(Ft[0],_t[0],mt[0],Et[0]),Math.max(Ft[1],_t[1],mt[1],Et[1]),Ot)):Je(Math.min(R,R+T),Math.min(k,k+P),Math.max(R,R+T),Math.max(k,k+P),Ot),f&&(y=Math.round(y),p=Math.round(p)),{drawImageX:y,drawImageY:p,drawImageW:C,drawImageH:x,originX:c,originY:h,declutterBox:{minX:Ot[0],minY:Ot[1],maxX:Ot[2],maxY:Ot[3],value:m},canvasTransform:v,scale:d}}replayImageOrLabel_(t,e,i,s,n,r,o){const a=!!(r||o),c=s.declutterBox,h=o?o[2]*s.scale[0]/2:0;return c.minX-h<=e[0]&&c.maxX+h>=0&&c.minY-h<=e[1]&&c.maxY+h>=0&&(a&&this.replayTextBackground_(t,Ft,_t,mt,Et,r,o),nr(t,s.canvasTransform,n,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=oe(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(i[0]%s,i[1]%s),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],e[1]&&(t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6]))}drawLabelWithPointPlacement_(t,e,i,s){const n=this.textStates[e],r=this.createLabel(t,e,s,i),o=this.strokeStates[i],a=this.pixelRatio,c=mi(Array.isArray(t)?t[0]:t,n.textAlign||fe),h=ii[n.textBaseline||qe],u=o&&o.lineWidth?o.lineWidth:0,d=r.width/a-2*n.scale[0],f=c*d+2*(.5-c)*u,g=h*r.height/a+2*(.5-h)*u;return{label:r,anchorX:f,anchorY:g}}execute_(t,e,i,s,n,r,o,a){const c=this.zIndexContext_;let h;this.pixelCoordinates_&&xe(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Xt(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),rr(this.renderedTransform_,i));let u=0;const d=s.length;let f=0,g,_,m,y,p,C,x,T,P,R,k,v,A,D=0,M=0;const G=this.coordinateCache_,S=this.viewRotation_,F=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,w={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:S},L=this.instructions!=s||this.overlaps?0:200;let b,Y,W,j;for(;u<d;){const E=s[u];switch(E[0]){case I.BEGIN_GEOMETRY:b=E[1],j=E[3],b.getGeometry()?o!==void 0&&!nt(o,j.getExtent())?u=E[2]+1:++u:u=E[2],c&&(c.zIndex=E[4]);break;case I.BEGIN_PATH:D>L&&(this.fill_(t),D=0),M>L&&(t.stroke(),M=0),!D&&!M&&(t.beginPath(),p=NaN,C=NaN),++u;break;case I.CIRCLE:f=E[1];const Qt=h[f],lt=h[f+1],Te=h[f+2],Qs=h[f+3],Zi=Te-Qt,Ki=Qs-lt,Hi=Math.sqrt(Zi*Zi+Ki*Ki);t.moveTo(Qt+Hi,lt),t.arc(Qt,lt,Hi,0,2*Math.PI,!0),++u;break;case I.CLOSE_PATH:t.closePath(),++u;break;case I.CUSTOM:f=E[1],g=E[2];const tn=E[3],en=E[4],qi=E[5];w.geometry=tn,w.feature=b,u in G||(G[u]=[]);const te=G[u];qi?qi(h,f,g,2,te):(te[0]=h[f],te[1]=h[f+1],te.length=2),c&&(c.zIndex=E[6]),en(te,w),++u;break;case I.DRAW_IMAGE:f=E[1],g=E[2],P=E[3],_=E[4],m=E[5];let ri=E[6];const sn=E[7],nn=E[8],rn=E[9],Ji=E[10];let oi=E[11];const on=E[12];let Ie=E[13];y=E[14]||"declutter";const ee=E[15];if(!P&&E.length>=20){R=E[19],k=E[20],v=E[21],A=E[22];const J=this.drawLabelWithPointPlacement_(R,k,v,A);P=J.label,E[3]=P;const It=E[23];_=(J.anchorX-It)*this.pixelRatio,E[4]=_;const z=E[24];m=(J.anchorY-z)*this.pixelRatio,E[5]=m,ri=P.height,E[6]=ri,Ie=P.width,E[13]=Ie}let ai;E.length>25&&(ai=E[25]);let li,Pe,Re;E.length>17?(li=E[16],Pe=E[17],Re=E[18]):(li=vt,Pe=null,Re=null),Ji&&F?oi+=S:!Ji&&!F&&(oi-=S);let an=0;for(;f<g;f+=2){if(ai&&ai[an++]<Ie/this.pixelRatio)continue;const J=this.calculateImageOrLabelDimensions_(P.width,P.height,h[f],h[f+1],Ie,ri,_,m,nn,rn,oi,on,n,li,!!Pe||!!Re,b),It=[t,e,P,J,sn,Pe,Re];if(a){let z,ht,$;if(ee){const B=g-f;if(!ee[B]){ee[B]={args:It,declutterMode:y};continue}const Z=ee[B];z=Z.args,ht=Z.declutterMode,delete ee[B],$=ps(z)}let ut,ft;if(z&&(ht!=="declutter"||!a.collides($))&&(ut=!0),(y!=="declutter"||!a.collides(J.declutterBox))&&(ft=!0),ht==="declutter"&&y==="declutter"){const B=ut&&ft;ut=B,ft=B}ut&&(ht!=="none"&&a.insert($),this.replayImageOrLabel_.apply(this,z)),ft&&(y!=="none"&&a.insert(J.declutterBox),this.replayImageOrLabel_.apply(this,It))}else this.replayImageOrLabel_.apply(this,It)}++u;break;case I.DRAW_CHARS:const zi=E[1],$i=E[2],hi=E[3],ln=E[4];A=E[5];const hn=E[6],Qi=E[7],ts=E[8];v=E[9];const ci=E[10];R=E[11],Array.isArray(R)&&(R=R.reduce(mo,"")),k=E[12];const es=[E[13],E[13]];y=E[14]||"declutter";const cn=E[15],di=this.textStates[k],ie=di.font,se=[di.scale[0]*Qi,di.scale[1]*Qi];let ne;ie in this.widths_?ne=this.widths_[ie]:(ne={},this.widths_[ie]=ne);const is=Yi(h,zi,$i,2),ss=Math.abs(se[0])*os(ie,R,ne);if(ln||ss<=is){const J=this.textStates[k].textAlign,It=(is-ss)*mi(R,J),z=go(h,zi,$i,2,R,It,hn,Math.abs(se[0]),os,ie,ne,F?0:this.viewRotation_,cn);t:if(z){const ht=[];let $,ut,ft,B,Z;if(v)for($=0,ut=z.length;$<ut;++$){Z=z[$],ft=Z[4],B=this.createLabel(ft,k,"",v),_=Z[2]+(se[0]<0?-ci:ci),m=hi*B.height+(.5-hi)*2*ci*se[1]/se[0]-ts;const gt=this.calculateImageOrLabelDimensions_(B.width,B.height,Z[0],Z[1],B.width,B.height,_,m,0,0,Z[3],es,!1,vt,!1,b);if(a&&y==="declutter"&&a.collides(gt.declutterBox))break t;ht.push([t,e,B,gt,1,null,null])}if(A)for($=0,ut=z.length;$<ut;++$){Z=z[$],ft=Z[4],B=this.createLabel(ft,k,A,""),_=Z[2],m=hi*B.height-ts;const gt=this.calculateImageOrLabelDimensions_(B.width,B.height,Z[0],Z[1],B.width,B.height,_,m,0,0,Z[3],es,!1,vt,!1,b);if(a&&y==="declutter"&&a.collides(gt.declutterBox))break t;ht.push([t,e,B,gt,1,null,null])}a&&y!=="none"&&a.load(ht.map(ps));for(let gt=0,dn=ht.length;gt<dn;++gt)this.replayImageOrLabel_.apply(this,ht[gt])}}++u;break;case I.END_GEOMETRY:if(r!==void 0){b=E[1];const J=r(b,j,y);if(J)return J}++u;break;case I.FILL:L?D++:this.fill_(t),++u;break;case I.MOVE_TO_LINE_TO:for(f=E[1],g=E[2],Y=h[f],W=h[f+1],t.moveTo(Y,W),p=Y+.5|0,C=W+.5|0,f+=2;f<g;f+=2)Y=h[f],W=h[f+1],x=Y+.5|0,T=W+.5|0,(f==g-2||x!==p||T!==C)&&(t.lineTo(Y,W),p=x,C=T);++u;break;case I.SET_FILL_STYLE:this.alignAndScaleFill_=E[2],D&&(this.fill_(t),D=0,M&&(t.stroke(),M=0)),t.fillStyle=E[1],++u;break;case I.SET_STROKE_STYLE:M&&(t.stroke(),M=0),this.setStrokeStyle_(t,E),++u;break;case I.STROKE:L?M++:t.stroke(),++u;break;default:++u;break}}D&&this.fill_(t),M&&t.stroke()}execute(t,e,i,s,n,r){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,n,void 0,void 0,r)}executeHitDetection(t,e,i,s,n){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,n)}}const Rt=["Polygon","Circle","LineString","Image","Text","Default"],Hs=["Image","Text"],po=Rt.filter(l=>!Hs.includes(l));class xo{constructor(t,e,i,s,n,r,o){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=ue(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(n,o)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let s=this.executorsByZIndex_[i];s===void 0&&(s={},this.executorsByZIndex_[i]=s);const n=t[i];for(const r in n){const o=n[r];s[r]=new yo(this.resolution_,this.pixelRatio_,this.overlaps_,o,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let s=0,n=t.length;s<n;++s)if(t[s]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,s,n,r){s=Math.round(s);const o=s*2+1,a=si(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-i,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=$e(o,o));const h=this.hitDetectionContext_;h.canvas.width!==o||h.canvas.height!==o?(h.canvas.width=o,h.canvas.height=o):c||h.clearRect(0,0,o,o);let u;this.renderBuffer_!==void 0&&(u=Zt(),or(u,t),Se(u,e*(this.renderBuffer_+s),u));const d=Co(s);let f;function g(T,P,R){const k=h.getImageData(0,0,o,o).data;for(let v=0,A=d.length;v<A;v++)if(k[d[v]]>0){if(!r||R==="none"||f!=="Image"&&f!=="Text"||r.includes(T)){const D=(d[v]-3)/4,M=s-D%o,G=s-(D/o|0),S=n(T,P,M*M+G*G);if(S)return S}h.clearRect(0,0,o,o);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(je);let m,y,p,C,x;for(m=_.length-1;m>=0;--m){const T=_[m].toString();for(p=this.executorsByZIndex_[T],y=Rt.length-1;y>=0;--y)if(f=Rt[y],C=p[f],C!==void 0&&(x=C.executeHitDetection(h,a,i,g,u),x))return x}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],s=e[1],n=e[2],r=e[3],o=[i,s,i,r,n,r,n,s];return Xt(o,0,8,2,t,o),o}isEmpty(){return Ht(this.executorsByZIndex_)}execute(t,e,i,s,n,r,o){const a=Object.keys(this.executorsByZIndex_).map(Number);a.sort(o?ar:je),r=r||Rt;const c=Rt.length;for(let h=0,u=a.length;h<u;++h){const d=a[h].toString(),f=this.executorsByZIndex_[d];for(let g=0,_=r.length;g<_;++g){const m=r[g],y=f[m];if(y!==void 0){const p=o===null?void 0:y.getZIndexContext(),C=p?p.getContext():t,x=this.maxExtent_&&m!=="Image"&&m!=="Text";if(x&&(C.save(),this.clip(C,i)),!p||m==="Text"||m==="Image"?y.execute(C,e,i,s,n,o):p.pushFunction(T=>y.execute(T,e,i,s,n,o)),x&&C.restore(),p){p.offset();const T=a[h]*c+Rt.indexOf(m);this.deferredZIndexContexts_[T]||(this.deferredZIndexContexts_[T]=[]),this.deferredZIndexContexts_[T].push(p)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(je);for(let i=0,s=e.length;i<s;++i)t[e[i]].forEach(n=>{n.draw(this.renderedContext_),n.clear()}),t[e[i]].length=0}}const yi={};function Co(l){if(yi[l]!==void 0)return yi[l];const t=l*2+1,e=l*l,i=new Array(e+1);for(let n=0;n<=l;++n)for(let r=0;r<=l;++r){const o=n*n+r*r;if(o>e)break;let a=i[o];a||(a=[],i[o]=a),a.push(((l+n)*t+(l+r))*4+3),n>0&&a.push(((l-n)*t+(l+r))*4+3),r>0&&(a.push(((l+n)*t+(l-r))*4+3),n>0&&a.push(((l-n)*t+(l-r))*4+3))}const s=[];for(let n=0,r=i.length;n<r;++n)i[n]&&s.push(...i[n]);return yi[l]=s,s}const ct=.5;function So(l,t,e,i,s,n,r,o,a){const c=s,h=l[0]*ct,u=l[1]*ct,d=$e(h,u);d.imageSmoothingEnabled=!1;const f=d.canvas,g=new Ur(d,ct,s,null,r,o,null),_=e.length,m=Math.floor((256*256*256-1)/_),y={};for(let C=1;C<=_;++C){const x=e[C-1],T=x.getStyleFunction()||i;if(!T)continue;let P=T(x,n);if(!P)continue;Array.isArray(P)||(P=[P]);const k=(C*m).toString(16).padStart(7,"#00000");for(let v=0,A=P.length;v<A;++v){const D=P[v],M=D.getGeometryFunction()(x);if(!M||!nt(c,M.getExtent()))continue;const G=D.clone(),S=G.getFill();S&&S.setColor(k);const F=G.getStroke();F&&(F.setColor(k),F.setLineDash(null)),G.setText(void 0);const w=D.getImage();if(w){const W=w.getImageSize();if(!W)continue;const j=$e(W[0],W[1],void 0,{alpha:!1}),E=j.canvas;j.fillStyle=k,j.fillRect(0,0,E.width,E.height),G.setImage(new lr({img:E,anchor:w.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:w.getOrigin(),opacity:1,size:w.getSize(),scale:w.getScale(),rotation:w.getRotation(),rotateWithView:w.getRotateWithView()}))}const L=G.getZIndex()||0;let b=y[L];b||(b={},y[L]=b,b.Polygon=[],b.Circle=[],b.LineString=[],b.Point=[]);const Y=M.getType();if(Y==="GeometryCollection"){const W=M.getGeometriesArrayRecursive();for(let j=0,E=W.length;j<E;++j){const $t=W[j];b[$t.getType().replace("Multi","")].push($t,G)}}else b[Y.replace("Multi","")].push(M,G)}}const p=Object.keys(y).map(Number).sort(je);for(let C=0,x=p.length;C<x;++C){const T=y[p[C]];for(const P in T){const R=T[P];for(let k=0,v=R.length;k<v;k+=2){g.setStyle(R[k+1]);for(let A=0,D=t.length;A<D;++A)g.setTransform(t[A]),g.drawGeometry(R[k])}}}return d.getImageData(0,0,f.width,f.height)}function Fo(l,t,e){const i=[];if(e){const s=Math.floor(Math.round(l[0])*ct),n=Math.floor(Math.round(l[1])*ct),r=(Li(s,0,e.width-1)+Li(n,0,e.height-1)*e.width)*4,o=e.data[r],a=e.data[r+1],h=e.data[r+2]+256*(a+256*o),u=Math.floor((256*256*256-1)/t.length);h&&h%u===0&&i.push(t[h/u-1])}return i}class Eo extends hr{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Zt(),this.wrappedRenderedExtent_=Zt(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){const s=e.extent,n=e.viewState,r=n.center,o=n.resolution,a=n.projection,c=n.rotation,h=a.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),f=e.pixelRatio,g=e.viewHints,_=!(g[Le.ANIMATING]||g[Le.INTERACTING]),m=this.context,y=Math.round(Nt(s)/o*f),p=Math.round(Ri(s)/o*f),C=u.getWrapX()&&a.canWrapX(),x=C?Nt(h):null,T=C?Math.ceil((s[2]-h[2])/x)+1:1;let P=C?Math.floor((s[0]-h[0])/x):0;do{let R=this.getRenderTransform(r,o,0,f,y,p,P*x);e.declutter&&(R=R.slice(0)),t.execute(m,[m.canvas.width,m.canvas.height],R,c,_,i===void 0?Rt:i?Hs:po,i?d&&e.declutter[d]:void 0)}while(++P<T)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=$e(this.context.canvas.width,this.context.canvas.height,as))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,cr(this.context),as.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const s=t.viewState;this.prepareContainer(t,e);const n=this.context,r=this.replayGroup_;let o=r&&!r.isEmpty();if(!o&&!(this.getLayer().hasListener(ls.PRERENDER)||this.getLayer().hasListener(ls.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(n,t),s.projection,this.clipped_=!1,o&&i.extent&&this.clipping){const a=Ns(i.extent);o=nt(a,t.extent),this.clipped_=o&&!Bt(a,t.extent),this.clipped_&&this.clipUnrotated(n,t,a)}return o&&this.renderWorlds(r,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&n.restore(),this.postRender(n,t),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),s=this.renderedCenter_,n=this.renderedResolution_,r=this.renderedRotation_,o=this.renderedProjection_,a=this.wrappedRenderedExtent_,c=this.getLayer(),h=[],u=i[0]*ct,d=i[1]*ct;h.push(this.getRenderTransform(s,n,r,ct,u,d,0).slice());const f=c.getSource(),g=o.getExtent();if(f.getWrapX()&&o.canWrapX()&&!Bt(g,a)){let _=a[0];const m=Nt(g);let y=0,p;for(;_<g[0];)--y,p=m*y,h.push(this.getRenderTransform(s,n,r,ct,u,d,p).slice()),_+=m;for(y=0,_=a[2];_>g[2];)++y,p=m*y,h.push(this.getRenderTransform(s,n,r,ct,u,d,p).slice()),_-=m}this.hitDetectionImageData_=So(i,h,this.renderedFeatures_,c.getStyleFunction(),a,n,r,us(n,this.renderedPixelRatio_))}e(Fo(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,s,n){if(!this.replayGroup_)return;const r=e.viewState.resolution,o=e.viewState.rotation,a=this.getLayer(),c={},h=function(d,f,g){const _=O(d),m=c[_];if(m){if(m!==!0&&g<m.distanceSq){if(g===0)return c[_]=!0,n.splice(n.lastIndexOf(m),1),s(d,a,f);m.geometry=f,m.distanceSq=g}}else{if(g===0)return c[_]=!0,s(d,a,f);n.push(c[_]={feature:d,layer:a,geometry:f,distanceSq:g,callback:s})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,r,o,i,h,u?e.declutter?.[u]?.all().map(d=>d.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const s=t.viewHints[Le.ANIMATING],n=t.viewHints[Le.INTERACTING],r=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!r&&s||!o&&n)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=t.extent,c=t.viewState,h=c.projection,u=c.resolution,d=t.pixelRatio,f=e.getRevision(),g=e.getRenderBuffer();let _=e.getRenderOrder();_===void 0&&(_=Kr);const m=c.center.slice(),y=Se(a,g*u),p=y.slice(),C=[y.slice()],x=h.getExtent();if(i.getWrapX()&&h.canWrapX()&&!Bt(x,t.extent)){const S=Nt(x),F=Math.max(Nt(y)/2,S);y[0]=x[0]-F,y[2]=x[2]+F,dr(m,h);const w=ur(C[0],h);w[0]<x[0]&&w[2]<x[2]?C.push([w[0]+S,w[1],w[2]+S,w[3]]):w[0]>x[0]&&w[2]>x[2]&&C.push([w[0]-S,w[1],w[2]-S,w[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==_&&this.renderedFrameDeclutter_===!!t.declutter&&Bt(this.wrappedRenderedExtent_,y))return xe(this.renderedExtent_,p)||(this.hitDetectionImageData_=null,this.renderedExtent_=p),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const T=new fo(Us(u,d),y,u,d);let P;for(let S=0,F=C.length;S<F;++S)i.loadFeatures(C[S],u,h);const R=us(u,d);let k=!0;const v=(S,F)=>{let w;const L=S.getStyleFunction()||e.getStyleFunction();if(L&&(w=L(S,u)),w){const b=this.renderFeature(S,R,w,T,P,this.getLayer().getDeclutter(),F);k=k&&!b}},A=Wi(y),D=i.getFeaturesInExtent(A);_&&D.sort(_);for(let S=0,F=D.length;S<F;++S)v(D[S],S);this.renderedFeatures_=D,this.ready=k;const M=T.finish(),G=new xo(y,u,d,i.getOverlaps(),M,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=_,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=p,this.wrappedRenderedExtent_=y,this.renderedCenter_=m,this.renderedProjection_=h,this.renderedPixelRatio_=d,this.replayGroup_=G,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,s,n,r,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let c=0,h=i.length;c<h;++c)a=fs(s,t,i[c],e,this.boundHandleStyleImageChange_,n,r,o)||a;else a=fs(s,t,i,e,this.boundHandleStyleImageChange_,n,r,o);return a}}class Vt extends fr{constructor(t){super(t)}createRenderer(){return new Eo(this)}}class wo{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=H,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?rt(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=rt(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return K()}readFeature(t,e){return K()}readFeatures(t,e){return K()}readGeometry(t,e){return K()}readProjection(t){return K()}writeFeature(t,e){return K()}writeFeatures(t,e){return K()}writeGeometry(t,e){return K()}}function Ee(l,t,e){const i=e?rt(e.featureProjection):null,s=e?rt(e.dataProjection):null;let n=l;if(i&&s&&!gr(i,s)){t&&(n=l.clone());const r=t?i:s,o=t?s:i;r.getUnits()==="tile-pixels"?n.transform(r,o):n.applyTransform(_r(r,o))}if(t&&e&&e.decimals!==void 0){const r=Math.pow(10,e.decimals),o=function(a){for(let c=0,h=a.length;c<h;++c)a[c]=Math.round(a[c]*r)/r;return a};n===l&&(n=l.clone()),n.applyTransform(o)}return n}const To={Point:it,LineString:at,Polygon:Kt,MultiPoint:Jt,MultiLineString:Gt,MultiPolygon:bt};function Io(l,t,e){return Array.isArray(t[0])?(bs(l,0,t,e)||(l=l.slice(),Ii(l,0,t,e)),l):(mr(l,0,t,e)||(l=l.slice(),yr(l,0,t,e)),l)}function qs(l,t){const e=l.geometry;if(!e)return[];if(Array.isArray(e))return e.map(n=>qs({...l,geometry:n})).flat();const i=e.type==="MultiPolygon"?"Polygon":e.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const s=e.layout.length;return Ee(new q(i,i==="Polygon"?Io(e.flatCoordinates,e.ends,s):e.flatCoordinates,e.ends?.flat(),s,l.properties||{},l.id).enableSimplifyTransformed(),!1,t)}function Xi(l,t){if(!l)return null;if(Array.isArray(l)){const i=l.map(s=>Xi(s,t));return new me(i)}const e=To[l.type];return Ee(new e(l.flatCoordinates,l.layout||"XY",l.ends),!1,t)}class Js extends wo{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Me(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Me(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return K()}readFeaturesFromObject(t,e){return K()}readGeometry(t,e){return this.readGeometryFromObject(Me(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return K()}readProjection(t){return this.readProjectionFromObject(Me(t))}readProjectionFromObject(t){return K()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return K()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return K()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return K()}}function Me(l){if(typeof l=="string"){const t=JSON.parse(l);return t||null}return l!==null?l:null}class Po extends Js{constructor(t){t=t||{},super(),this.dataProjection=rt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=rt(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const s=Vi(i.geometry);if(this.featureClass===q)return qs({geometry:s,id:i.id,properties:i.properties},e);const n=new H;return this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&n.setGeometryName(i.geometry_name),n.setGeometry(Xi(s,e)),"id"in i&&n.setId(i.id),i.properties&&n.setProperties(i.properties,!0),n}readFeaturesFromObject(t,e){const i=t;let s=null;if(i.type==="FeatureCollection"){const n=t;s=[];const r=n.features;for(let o=0,a=r.length;o<a;++o){const c=this.readFeatureFromObject(r[o],e);c&&s.push(c)}}else s=[this.readFeatureFromObject(t,e)];return s.flat()}readGeometryFromObject(t,e){return Ro(t,e)}readProjectionFromObject(t){const e=t.crs;let i;if(e)if(e.type=="name")i=rt(e.properties.name);else if(e.type==="EPSG")i=rt("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},s=t.getId();if(s!==void 0&&(i.id=s),!t.hasProperties())return i;const n=t.getProperties(),r=t.getGeometry();return r&&(i.geometry=Gi(r,e),delete n[t.getGeometryName()]),Ht(n)||(i.properties=n),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let s=0,n=t.length;s<n;++s)i.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return Gi(t,this.adaptOptions(e))}}function Vi(l,t){if(!l)return null;let e;switch(l.type){case"Point":{e=Lo(l);break}case"LineString":{e=ko(l);break}case"Polygon":{e=bo(l);break}case"MultiPoint":{e=Do(l);break}case"MultiLineString":{e=Mo(l);break}case"MultiPolygon":{e=Go(l);break}case"GeometryCollection":{e=vo(l);break}default:throw new Error("Unsupported GeoJSON type: "+l.type)}return e}function Ro(l,t){const e=Vi(l);return Xi(e,t)}function vo(l,t){return l.geometries.map(function(i){return Vi(i)})}function Lo(l){const t=l.coordinates;return{type:"Point",flatCoordinates:t,layout:qt(t.length)}}function ko(l){const t=l.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:qt(t[0]?.length||2)}}function Mo(l){const t=l.coordinates,e=t[0]?.[0]?.length||2,i=[],s=Ai(i,0,t,e);return{type:"MultiLineString",flatCoordinates:i,ends:s,layout:qt(e)}}function Do(l){const t=l.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:qt(t[0]?.length||2)}}function Go(l){const t=l.coordinates,e=[],i=t[0]?.[0]?.[0].length||2,s=Os(e,0,t,i);return{type:"MultiPolygon",flatCoordinates:e,ends:s,layout:qt(i)}}function bo(l){const t=l.coordinates,e=[],i=t[0]?.[0]?.length,s=Ai(e,0,t,i);return{type:"Polygon",flatCoordinates:e,ends:s,layout:qt(i)}}function Gi(l,t){l=Ee(l,!0,t);const e=l.getType();let i;switch(e){case"Point":{i=jo(l);break}case"LineString":{i=Ao(l);break}case"Polygon":{i=Yo(l,t);break}case"MultiPoint":{i=Wo(l);break}case"MultiLineString":{i=No(l);break}case"MultiPolygon":{i=Bo(l,t);break}case"GeometryCollection":{i=Oo(l,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function Oo(l,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:l.getGeometriesArray().map(function(i){return Gi(i,t)})}}function Ao(l,t){return{type:"LineString",coordinates:l.getCoordinates()}}function No(l,t){return{type:"MultiLineString",coordinates:l.getCoordinates()}}function Wo(l,t){return{type:"MultiPoint",coordinates:l.getCoordinates()}}function Bo(l,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:l.getCoordinates(e)}}function jo(l,t){return{type:"Point",coordinates:l.getCoordinates()}}function Yo(l,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:l.getCoordinates(e)}}const Xo={Point:Ko,LineString:Ho,Polygon:$o,MultiPoint:Jo,MultiLineString:qo,MultiPolygon:zo},Vo={Point:Qo,LineString:ta,Polygon:ea,MultiPoint:sa,MultiLineString:ia,MultiPolygon:na};class Uo extends Js{constructor(t){t=t||{},super(),this.geometryName_=t.geometryName}readFeatureFromObject(t,e,i){const s=t,n=Cs(s.geometry,e),r=new H;if(this.geometryName_&&r.setGeometryName(this.geometryName_),r.setGeometry(n),s.attributes){r.setProperties(s.attributes,!0);const o=s.attributes[i];o!==void 0&&r.setId(o)}return r}readFeaturesFromObject(t,e){if(e=e||{},t.features){const i=t,s=[],n=i.features;for(let r=0,o=n.length;r<o;++r)s.push(this.readFeatureFromObject(n[r],e,t.objectIdFieldName));return s}return[this.readFeatureFromObject(t,e)]}readGeometryFromObject(t,e){return Cs(t,e)}readProjectionFromObject(t){if(t.spatialReference&&t.spatialReference.wkid!==void 0){const i=t.spatialReference.wkid;return rt("EPSG:"+i)}return null}writeGeometryObject(t,e){return Ss(t,this.adaptOptions(e))}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={};if(!t.hasProperties())return i.attributes={},i;const s=t.getProperties(),n=t.getGeometry();if(n){i.geometry=Ss(n,e);const r=e&&(e.dataProjection||e.featureProjection);r&&(i.geometry.spatialReference={wkid:Number(rt(r).getCode().split(":").pop())}),delete s[t.getGeometryName()]}return Ht(s)?i.attributes={}:i.attributes=s,i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let s=0,n=t.length;s<n;++s)i.push(this.writeFeatureObject(t[s],e));return{features:i}}}function Cs(l,t){if(!l)return null;let e;if(typeof l.x=="number"&&typeof l.y=="number")e="Point";else if(l.points)e="MultiPoint";else if(l.paths)l.paths.length===1?e="LineString":e="MultiLineString";else if(l.rings){const s=l,n=zt(s),r=Zo(s.rings,n);r.length===1?(e="Polygon",l=Object.assign({},l,{rings:r[0]})):(e="MultiPolygon",l=Object.assign({},l,{rings:r}))}const i=Xo[e];return Ee(i(l),!1,t)}function Zo(l,t){const e=[],i=[],s=[];let n,r;for(n=0,r=l.length;n<r;++n)e.length=0,Oi(e,0,l[n],t.length),pr(e,0,e.length,t.length)?i.push([l[n]]):s.push(l[n]);for(;s.length;){const o=s.shift();let a=!1;for(n=i.length-1;n>=0;n--){const c=i[n][0];if(Bt(new hs(c).getExtent(),new hs(o).getExtent())){i[n].push(o),a=!0;break}}a||i.push([o.reverse()])}return i}function Ko(l){let t;return l.m!==void 0&&l.z!==void 0?t=new it([l.x,l.y,l.z,l.m],"XYZM"):l.z!==void 0?t=new it([l.x,l.y,l.z],"XYZ"):l.m!==void 0?t=new it([l.x,l.y,l.m],"XYM"):t=new it([l.x,l.y]),t}function Ho(l){const t=zt(l);return new at(l.paths[0],t)}function qo(l){const t=zt(l);return new Gt(l.paths,t)}function zt(l){let t="XY";return l.hasZ===!0&&l.hasM===!0?t="XYZM":l.hasZ===!0?t="XYZ":l.hasM===!0&&(t="XYM"),t}function Jo(l){const t=zt(l);return new Jt(l.points,t)}function zo(l){const t=zt(l);return new bt(l.rings,t)}function $o(l){const t=zt(l);return new Kt(l.rings,t)}function Qo(l,t){const e=l.getCoordinates();let i;const s=l.getLayout();if(s==="XYZ")i={x:e[0],y:e[1],z:e[2]};else if(s==="XYM")i={x:e[0],y:e[1],m:e[2]};else if(s==="XYZM")i={x:e[0],y:e[1],z:e[2],m:e[3]};else if(s==="XY")i={x:e[0],y:e[1]};else throw new Error("Invalid geometry layout");return i}function we(l){const t=l.getLayout();return{hasZ:t==="XYZ"||t==="XYZM",hasM:t==="XYM"||t==="XYZM"}}function ta(l,t){const e=we(l);return{hasZ:e.hasZ,hasM:e.hasM,paths:[l.getCoordinates()]}}function ea(l,t){const e=we(l);return{hasZ:e.hasZ,hasM:e.hasM,rings:l.getCoordinates(!1)}}function ia(l,t){const e=we(l);return{hasZ:e.hasZ,hasM:e.hasM,paths:l.getCoordinates()}}function sa(l,t){const e=we(l);return{hasZ:e.hasZ,hasM:e.hasM,points:l.getCoordinates()}}function na(l,t){const e=we(l),i=l.getCoordinates(!1),s=[];for(let n=0;n<i.length;n++)for(let r=i[n].length-1;r>=0;r--)s.push(i[n][r]);return{hasZ:e.hasZ,hasM:e.hasM,rings:s}}function Ss(l,t){const e=Vo[l.getType()];return e(Ee(l,!0,t),t)}const De={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Ge extends Ce{constructor(t,e){super(t),this.feature=e}}function ra(l,t){const e=[];for(let i=0;i<t.length;++i){const n=t[i].getGeometry();zs(l,n,e)}return e}function be(l,t){return Ni(l[0],l[1],t[0],t[1])}function jt(l,t){const e=l.length;return t<0?l[t+e]:t>=e?l[t-e]:l[t]}function Oe(l,t,e){let i,s;t<e?(i=t,s=e):(i=e,s=t);const n=Math.ceil(i),r=Math.floor(s);if(n>r){const a=Yt(l,i),c=Yt(l,s);return be(a,c)}let o=0;if(i<n){const a=Yt(l,i),c=jt(l,n);o+=be(a,c)}if(r<s){const a=jt(l,r),c=Yt(l,s);o+=be(a,c)}for(let a=n;a<r-1;++a){const c=jt(l,a),h=jt(l,a+1);o+=be(c,h)}return o}function zs(l,t,e){if(t instanceof at){Ae(l,t.getCoordinates(),!1,e);return}if(t instanceof Gt){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s)Ae(l,i[s],!1,e);return}if(t instanceof Kt){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s)Ae(l,i[s],!0,e);return}if(t instanceof bt){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,a=r.length;o<a;++o)Ae(l,r[o],!0,e)}return}if(t instanceof me){const i=t.getGeometries();for(let s=0;s<i.length;++s)zs(l,i[s],e);return}}const pi={index:-1,endIndex:NaN};function oa(l,t,e,i){const s=l[0],n=l[1];let r=1/0,o=-1,a=NaN;for(let u=0;u<t.targets.length;++u){const d=t.targets[u],f=d.coordinates;let g=1/0,_;for(let m=0;m<f.length-1;++m){const y=f[m],p=f[m+1],C=$s(s,n,y,p);C.squaredDistance<g&&(g=C.squaredDistance,_=m+C.along)}g<r&&(r=g,d.ring&&t.targetIndex===u&&(d.endIndex>d.startIndex?_<d.startIndex&&(_+=f.length):d.endIndex<d.startIndex&&_>d.startIndex&&(_-=f.length)),a=_,o=u)}const c=t.targets[o];let h=c.ring;if(t.targetIndex===o&&h){const u=Yt(c.coordinates,a),d=e.getPixelFromCoordinate(u);Qe(d,t.startPx)>i&&(h=!1)}if(h){const u=c.coordinates,d=u.length,f=c.startIndex,g=a;if(f<g){const _=Oe(u,f,g);Oe(u,f,g-d)<_&&(a-=d)}else{const _=Oe(u,f,g);Oe(u,f,g+d)<_&&(a+=d)}}return pi.index=o,pi.endIndex=a,pi}function Ae(l,t,e,i){const s=l[0],n=l[1];for(let r=0,o=t.length-1;r<o;++r){const a=t[r],c=t[r+1],h=$s(s,n,a,c);if(h.squaredDistance===0){const u=r+h.along;i.push({coordinates:t,ring:e,startIndex:u,endIndex:u});return}}}const xi={along:0,squaredDistance:0};function $s(l,t,e,i){const s=e[0],n=e[1],r=i[0],o=i[1],a=r-s,c=o-n;let h=0,u=s,d=n;return(a!==0||c!==0)&&(h=Li(((l-s)*a+(t-n)*c)/(a*a+c*c),0,1),u+=a*h,d+=c*h),xi.along=h,xi.squaredDistance=Rs(Ni(l,t,u,d),10),xi}function Yt(l,t){const e=l.length;let i=Math.floor(t);const s=t-i;i>=e?i-=e:i<0&&(i+=e);let n=i+1;n>=e&&(n-=e);const r=l[i],o=r[0],a=r[1],c=l[n],h=c[0]-o,u=c[1]-a;return[o+h*s,a+u*s]}class aa extends Bi{constructor(t){const e=t;e.stopDown||(e.stopDown=Ws),super(e),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=t.source?t.source:null,this.features_=t.features?t.features:null,this.snapTolerance_=t.snapTolerance?t.snapTolerance:12,this.type_=t.type,this.mode_=ha(this.type_),this.stopClick_=!!t.stopClick,this.minPoints_=t.minPoints?t.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:t.maxPoints?t.maxPoints:1/0,this.finishCondition_=t.finishCondition?t.finishCondition:ge,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY";let i=t.geometryFunction;if(!i){const s=this.mode_;if(s==="Circle")i=(n,r,o)=>{const a=r||new ni([NaN,NaN]),c=X(n[0]),h=Mt(c,X(n[n.length-1]));return a.setCenterAndRadius(c,Math.sqrt(h),this.geometryLayout_),a};else{let n;s==="Point"?n=it:s==="LineString"?n=at:s==="Polygon"&&(n=Kt),i=(r,o,a)=>(o?s==="Polygon"?r[0].length?o.setCoordinates([r[0].concat([r[0][0]])],this.geometryLayout_):o.setCoordinates([],this.geometryLayout_):o.setCoordinates(r,this.geometryLayout_):o=new n(r,this.geometryLayout_),o)}}this.geometryFunction_=i,this.dragVertexDelay_=t.dragVertexDelay!==void 0?t.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.overlay_=new Vt({source:new ce({useSpatialIndex:!1,wrapX:t.wrapX?t.wrapX:!1}),style:t.style?t.style:la(),updateWhileInteracting:!0}),this.geometryName_=t.geometryName,this.condition_=t.condition?t.condition:xr,this.freehandCondition_,t.freehand?this.freehandCondition_=ki:this.freehandCondition_=t.freehandCondition?t.freehandCondition:Bs,this.traceCondition_,this.setTrace(t.trace||!1),this.traceState_={active:!1},this.traceSource_=t.traceSource||t.source||null,this.addChangeListener(Cr.ACTIVE,this.updateState_)}setTrace(t){let e;t?t===!0?e=ki:e=t:e=Mi,this.traceCondition_=e}setMap(t){super.setMap(t),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(t){t.originalEvent.type===Dt.CONTEXTMENU&&t.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(t);let e=t.type===Q.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&t.type===Q.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&t.type===Q.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===Q.POINTERDOWN?i=!1:e&&this.getPointerCount()<2?(i=t.type===Q.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.originalEvent.preventDefault()):(t.originalEvent.pointerType==="mouse"||t.type===Q.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(t)):t.type===Q.DBLCLICK&&(i=!1),super.handleEvent(t)&&i}handleDownEvent(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Sr(Q.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))},this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(t){if(!this.traceSource_||!this.traceCondition_(t))return;if(this.traceState_.active){this.deactivateTrace_();return}const e=this.getMap(),i=e.getCoordinateFromPixel([t.pixel[0]-this.snapTolerance_,t.pixel[1]+this.snapTolerance_]),s=e.getCoordinateFromPixel([t.pixel[0]+this.snapTolerance_,t.pixel[1]-this.snapTolerance_]),n=U([i,s]),r=this.traceSource_.getFeaturesInExtent(n);if(r.length===0)return;const o=ra(t.coordinate,r);o.length&&(this.traceState_={active:!0,startPx:t.pixel.slice(),targets:o,targetIndex:-1})}addOrRemoveTracedCoordinates_(t,e){const i=t.startIndex<=t.endIndex,s=t.startIndex<=e;i===s?i&&e>t.endIndex||!i&&e<t.endIndex?this.addTracedCoordinates_(t,t.endIndex,e):(i&&e<t.endIndex||!i&&e>t.endIndex)&&this.removeTracedCoordinates_(e,t.endIndex):(this.removeTracedCoordinates_(t.startIndex,t.endIndex),this.addTracedCoordinates_(t,t.startIndex,e))}removeTracedCoordinates_(t,e){if(t===e)return;let i=0;if(t<e){const s=Math.ceil(t);let n=Math.floor(e);n===e&&(n-=1),i=n-s+1}else{const s=Math.floor(t);let n=Math.ceil(e);n===e&&(n+=1),i=s-n+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(t,e,i){if(e===i)return;const s=[];if(e<i){const n=Math.ceil(e);let r=Math.floor(i);r===i&&(r-=1);for(let o=n;o<=r;++o)s.push(jt(t.coordinates,o))}else{const n=Math.floor(e);let r=Math.ceil(i);r===i&&(r+=1);for(let o=n;o>=r;--o)s.push(jt(t.coordinates,o))}s.length&&this.appendCoordinates(s)}updateTrace_(t){const e=this.traceState_;if(!e.active||e.targetIndex===-1&&Qe(e.startPx,t.pixel)<this.snapTolerance_)return;const i=oa(t.coordinate,e,this.getMap(),this.snapTolerance_);if(e.targetIndex!==i.index){if(e.targetIndex!==-1){const a=e.targets[e.targetIndex];this.removeTracedCoordinates_(a.startIndex,a.endIndex)}const o=e.targets[i.index];this.addTracedCoordinates_(o,o.startIndex,i.endIndex)}else{const o=e.targets[e.targetIndex];this.addOrRemoveTracedCoordinates_(o,i.endIndex)}e.targetIndex=i.index;const s=e.targets[e.targetIndex];s.endIndex=i.endIndex;const n=Yt(s.coordinates,s.endIndex),r=this.getMap().getPixelFromCoordinate(n);t.coordinate=n,t.pixel=[Math.round(r[0]),Math.round(r[1])]}handleUpEvent(t){let e=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);const i=this.traceState_.active;if(this.toggleTraceState_(t),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(t.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(t.pixel,i)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing()}return!e&&this.stopClick_&&t.preventDefault(),e}handlePointerMove_(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const e=this.downPx_,i=t.pixel,s=e[0]-i[0],n=e[1]-i[1],r=s*s+n*n;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(t.coordinate.slice());return}this.updateTrace_(t),this.modifyDrawing_(t.coordinate)}atFinish_(t,e){let i=!1;if(this.sketchFeature_){let s=!1,n=[this.finishCoordinate_];const r=this.mode_;if(r==="Point")i=!0;else if(r==="Circle")i=this.sketchCoords_.length===2;else if(r==="LineString")s=!e&&this.sketchCoords_.length>this.minPoints_;else if(r==="Polygon"){const o=this.sketchCoords_;s=o[0].length>this.minPoints_,n=[o[0][0],o[0][o[0].length-2]],e?n=[o[0][0]]:n=[o[0][0],o[0][o[0].length-2]]}if(s){const o=this.getMap();for(let a=0,c=n.length;a<c;a++){const h=n[a],u=o.getPixelFromCoordinate(h),d=t[0]-u[0],f=t[1]-u[1],g=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(d*d+f*f)<=g,i){this.finishCoordinate_=h;break}}}}return i}createOrUpdateSketchPoint_(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new H(new it(t)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(t){this.sketchLine_||(this.sketchLine_=new H);const e=t.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),i.changed()):(i=new at(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(t){const e=this.getMap().getView().getProjection(),i=cs(this.geometryLayout_);for(;t.length<i;)t.push(0);this.finishCoordinate_=t,this.mode_==="Point"?this.sketchCoords_=t.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new H(new at(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new H,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new Ge(De.DRAWSTART,this.sketchFeature_))}modifyDrawing_(t){const e=this.getMap(),i=this.sketchFeature_.getGeometry(),s=e.getView().getProjection(),n=cs(this.geometryLayout_);let r,o;for(;t.length<n;)t.push(0);this.mode_==="Point"?o=this.sketchCoords_:this.mode_==="Polygon"?(r=this.sketchCoords_[0],o=r[r.length-1],this.atFinish_(e.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):(r=this.sketchCoords_,o=r[r.length-1]),o[0]=t[0],o[1]=t[1],this.geometryFunction_(this.sketchCoords_,i,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(t),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(t){const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let s,n;const r=this.mode_;return r==="LineString"||r==="Circle"?(this.finishCoordinate_=t.slice(),n=this.sketchCoords_,n.length>=this.maxPoints_&&(this.freehand_?n.pop():s=!0),n.push(t.slice()),this.geometryFunction_(n,e,i)):r==="Polygon"&&(n=this.sketchCoords_[0],n.length>=this.maxPoints_&&(this.freehand_?n.pop():s=!0),n.push(t.slice()),s&&(this.finishCoordinate_=n[0]),this.geometryFunction_(this.sketchCoords_,e,i)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),s?this.finishDrawing():this.sketchFeature_}removeLastPoints_(t){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let n=0;n<t;++n){let r;if(s==="LineString"||s==="Circle"){if(r=this.sketchCoords_,r.splice(-2,1),r.length>=2){this.finishCoordinate_=r[r.length-2].slice();const o=this.finishCoordinate_.slice();r[r.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(r,e,i),e.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if(s==="Polygon"){r=this.sketchCoords_[0],r.splice(-2,1);const o=this.sketchLine_.getGeometry();if(r.length>=2){const a=r[r.length-2].slice();r[r.length-1]=a,this.createOrUpdateSketchPoint_(a)}o.setCoordinates(r),this.geometryFunction_(this.sketchCoords_,e,i)}if(r.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const t=this.abortDrawing_();if(!t)return null;let e=this.sketchCoords_;const i=t.getGeometry(),s=this.getMap().getView().getProjection();return this.mode_==="LineString"?(e.pop(),this.geometryFunction_(e,i,s)):this.mode_==="Polygon"&&(e[0].pop(),this.geometryFunction_(e,i,s),e=i.getCoordinates()),this.type_==="MultiPoint"?t.setGeometry(new Jt([e])):this.type_==="MultiLineString"?t.setGeometry(new Gt([e])):this.type_==="MultiPolygon"&&t.setGeometry(new bt([e])),this.dispatchEvent(new Ge(De.DRAWEND,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t),t}abortDrawing_(){this.finishCoordinate_=null;const t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),t}abortDrawing(){const t=this.abortDrawing_();t&&this.dispatchEvent(new Ge(De.DRAWABORT,t))}appendCoordinates(t){const e=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(t[0]);let s;if(e==="LineString"||e==="Circle")s=this.sketchCoords_;else if(e==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&s.shift(),s.pop();for(let r=0;r<t.length;r++)this.addToDrawing_(t[r]);const n=t[t.length-1];this.sketchFeature_=this.addToDrawing_(n),this.modifyDrawing_(n)}extend(t){const i=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=i.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new H(new it(s)),this.updateSketchFeatures_(),this.dispatchEvent(new Ge(De.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);const e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)}updateState_(){const t=this.getMap(),e=this.getActive();(!t||!e)&&this.abortDrawing(),this.overlay_.setMap(e?t:null)}}function la(){const l=ji();return function(t,e){return l[t.getGeometry().getType()]}}function ha(l){switch(l){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+l)}}const Fs=0,de=1,Es=[0,0,0,0],Ut=[],Ci={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Si extends Ce{constructor(t,e,i){super(t),this.features=e,this.mapBrowserEvent=i}}class ca extends Bi{constructor(t){super(t),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=t.condition?t.condition:Fr,this.defaultDeleteCondition_=function(i){return Er(i)&&js(i)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:ki,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ei,this.pixelTolerance_=t.pixelTolerance!==void 0?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Vt({source:new ce({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:ua(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let e;if(t.features?e=t.features:t.source&&(this.source_=t.source,e=new ze(this.source_.getFeatures()),this.source_.addEventListener(V.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(V.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!e)throw new Error("The modify interaction requires features, a source or a layer");t.hitDetection&&(this.hitDetection_=t.hitDetection),this.features_=e,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(dt.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(dt.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=t.snapToPointer===void 0?!this.hitDetection_:t.snapToPointer}addFeature_(t){const e=t.getGeometry();if(e){const s=this.SEGMENT_WRITERS_[e.getType()];s&&s(t,e)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(i.getCoordinateFromPixel(this.lastPixel_)),t.addEventListener(Dt.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(t,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new ze;const i=this.featuresBeingModified_.getArray();for(let s=0,n=e.length;s<n;++s){const r=e[s].feature;r&&!i.includes(r)&&this.featuresBeingModified_.push(r)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Si(Ci.MODIFYSTART,this.featuresBeingModified_,t))}}removeFeature_(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(Dt.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(t){const e=this.rBush_,i=[];e.forEach(function(s){t===s.feature&&i.push(s)});for(let s=i.length-1;s>=0;--s){const n=i[s];for(let r=this.dragSegments_.length-1;r>=0;--r)this.dragSegments_[r][0]===n&&this.dragSegments_.splice(r,1);e.remove(n)}}setActive(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(t)}setMap(t){this.overlay_.setMap(t),super.setMap(t)}getOverlay(){return this.overlay_}handleSourceAdd_(t){t.feature&&this.features_.push(t.feature)}handleSourceRemove_(t){t.feature&&this.features_.remove(t.feature)}handleFeatureAdd_(t){this.addFeature_(t.element)}handleFeatureChange_(t){if(!this.changingFeature_){const e=t.target;this.removeFeature_(e),this.addFeature_(e)}}handleFeatureRemove_(t){this.removeFeature_(t.element)}writePointGeometry_(t,e){const i=e.getCoordinates(),s={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),s)}writeMultiPointGeometry_(t,e){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s],o={feature:t,geometry:e,depth:[s],index:s,segment:[r,r]};this.rBush_.insert(e.getExtent(),o)}}writeLineStringGeometry_(t,e){const i=e.getCoordinates();for(let s=0,n=i.length-1;s<n;++s){const r=i.slice(s,s+2),o={feature:t,geometry:e,index:s,segment:r};this.rBush_.insert(U(r),o)}}writeMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,a=r.length-1;o<a;++o){const c=r.slice(o,o+2),h={feature:t,geometry:e,depth:[s],index:o,segment:c};this.rBush_.insert(U(c),h)}}}writePolygonGeometry_(t,e){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,a=r.length-1;o<a;++o){const c=r.slice(o,o+2),h={feature:t,geometry:e,depth:[s],index:o,segment:c};this.rBush_.insert(U(c),h)}}}writeMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,a=r.length;o<a;++o){const c=r[o];for(let h=0,u=c.length-1;h<u;++h){const d=c.slice(h,h+2),f={feature:t,geometry:e,depth:[o,s],index:h,segment:d};this.rBush_.insert(U(d),f)}}}}writeCircleGeometry_(t,e){const i=e.getCenter(),s={feature:t,geometry:e,index:Fs,segment:[i,i]},n={feature:t,geometry:e,index:de,segment:[i,i]},r=[s,n];s.featureSegments=r,n.featureSegments=r,this.rBush_.insert(Be(i),s);let o=e;this.rBush_.insert(o.getExtent(),n)}writeGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let s=0;s<i.length;++s){const n=i[s],r=this.SEGMENT_WRITERS_[n.getType()];r(t,n)}}createOrUpdateVertexFeature_(t,e,i,s){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(t):(n=new H(new it(t)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",e),n.set("geometries",i),n.set("existing",s),n}handleEvent(t){if(!t.originalEvent)return!0;this.lastPointerEvent_=t;let e;return!t.map.getView().getInteracting()&&t.type==Q.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(t.type!=Q.SINGLECLICK||!this.ignoreNextSingleClick_?e=this.removePoint():e=!0),t.type==Q.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(t)&&!e}findInsertVerticesAndUpdateDragSegments_(t){this.handlePointerAtPixel_(t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const e=this.vertexFeature_;if(!e)return;this.getMap().getView().getProjection();const i=[],s=e.getGeometry().getCoordinates(),n=U([s]),r=this.rBush_.getInExtent(n),o={};r.sort(da);for(let a=0,c=r.length;a<c;++a){const h=r[a],u=h.segment;let d=O(h.geometry);const f=h.depth;if(f&&(d+="-"+f.join("-")),o[d]||(o[d]=new Array(2)),h.geometry.getType()==="Circle"&&h.index===de){const g=Ts(t,h);st(g,s)&&!o[d][0]&&(this.dragSegments_.push([h,0]),o[d][0]=h);continue}if(st(u[0],s)&&!o[d][0]){this.dragSegments_.push([h,0]),o[d][0]=h;continue}if(st(u[1],s)&&!o[d][1]){if(o[d][0]&&o[d][0].index===0){let g=h.geometry.getCoordinates();switch(h.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":g=g[f[1]];case"Polygon":if(h.index!==g[f[0]].length-2)continue;break}}this.dragSegments_.push([h,1]),o[d][1]=h;continue}O(u)in this.vertexSegments_&&!o[d][0]&&!o[d][1]&&i.push(h)}return i}handleDragEvent(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t,this.dragSegments_.map(([n])=>n));const e=[t.coordinate[0]+this.delta_[0],t.coordinate[1]+this.delta_[1]],i=[],s=[];for(let n=0,r=this.dragSegments_.length;n<r;++n){const o=this.dragSegments_[n],a=o[0],c=a.feature;i.includes(c)||i.push(c);const h=a.geometry;s.includes(h)||s.push(h);const u=a.depth;let d;const f=a.segment,g=o[1];for(;e.length<h.getStride();)e.push(f[g][e.length]);switch(h.getType()){case"Point":d=e,f[0]=e,f[1]=e;break;case"MultiPoint":d=h.getCoordinates(),d[a.index]=e,f[0]=e,f[1]=e;break;case"LineString":d=h.getCoordinates(),d[a.index+g]=e,f[g]=e;break;case"MultiLineString":d=h.getCoordinates(),d[u[0]][a.index+g]=e,f[g]=e;break;case"Polygon":d=h.getCoordinates(),d[u[0]][a.index+g]=e,f[g]=e;break;case"MultiPolygon":d=h.getCoordinates(),d[u[1]][u[0]][a.index+g]=e,f[g]=e;break;case"Circle":const _=h;if(f[0]=e,f[1]=e,a.index===Fs)this.changingFeature_=!0,_.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,t.map.getView().getProjection();let m=Qe(X(_.getCenter()),X(e));_.setRadius(m),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(h,d)}this.createOrUpdateVertexFeature_(e,i,s,!0)}handleDownEvent(t){if(!this.condition_(t))return!1;const e=t.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(e);if(i?.length&&this.insertVertexCondition_(t)&&(this.willModifyFeatures_(t,i),this.vertexFeature_)){const s=this.vertexFeature_.getGeometry().getCoordinates();for(let n=i.length-1;n>=0;--n)this.insertVertex_(i[n],s);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(t){for(let e=this.dragSegments_.length-1;e>=0;--e){const i=this.dragSegments_[e][0],s=i.geometry;if(s.getType()==="Circle"){const n=s,r=n.getCenter(),o=i.featureSegments[0],a=i.featureSegments[1];o.segment[0]=r,o.segment[1]=r,a.segment[0]=r,a.segment[1]=r,this.rBush_.update(Be(r),o);let c=n;this.rBush_.update(c.getExtent(),a)}else this.rBush_.update(U(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Si(Ci.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null),!1}handlePointerMove_(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.coordinate)}handlePointerAtPixel_(t){const e=this.getMap(),i=e.getPixelFromCoordinate(t);e.getView().getProjection();const s=function(o,a){return ws(t,o)-ws(t,a)};let n,r;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?a=>a===this.hitDetection_:void 0;e.forEachFeatureAtPixel(i,(a,c,h)=>{h&&h.getType()==="Point"&&(h=new it(_e(h.getCoordinates())));const u=h||a.getGeometry();if(u&&u.getType()==="Point"&&a instanceof H&&this.features_.getArray().includes(a)){r=u;const d=a.getGeometry().getFlatCoordinates().slice(0,2);n=[{feature:a,geometry:r,segment:[d,d]}]}return!0},{layerFilter:o})}if(!n){const o=Ns(Be(t,Es)),a=e.getView().getResolution()*this.pixelTolerance_,c=Wi(Se(o,a,Es));n=this.rBush_.getInExtent(c)}if(n&&n.length>0){const o=n.sort(s)[0],a=o.segment;let c=Ts(t,o);const h=e.getPixelFromCoordinate(c);let u=Qe(i,h);if(r||u<=this.pixelTolerance_){const d={};if(d[O(a)]=!0,this.snapToPointer_||(this.delta_[0]=c[0]-t[0],this.delta_[1]=c[1]-t[1]),o.geometry.getType()==="Circle"&&o.index===de)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(c,[o.feature],[o.geometry],this.snappedToVertex_);else{const f=e.getPixelFromCoordinate(a[0]),g=e.getPixelFromCoordinate(a[1]),_=Mt(h,f),m=Mt(h,g);if(u=Math.sqrt(Math.min(_,m)),this.snappedToVertex_=u<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(c=_>m?a[1]:a[0]),this.createOrUpdateVertexFeature_(c,[o.feature],[o.geometry],this.snappedToVertex_);const y={};y[O(o.geometry)]=!0;for(let p=1,C=n.length;p<C;++p){const x=n[p].segment;if(st(a[0],x[0])&&st(a[1],x[1])||st(a[0],x[1])&&st(a[1],x[0])){const T=O(n[p].geometry);T in y||(y[T]=!0,d[O(x)]=!0)}else break}}this.vertexSegments_=d;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(t,e){const i=t.segment,s=t.feature,n=t.geometry,r=t.depth,o=t.index;let a;for(;e.length<n.getStride();)e.push(0);switch(n.getType()){case"MultiLineString":a=n.getCoordinates(),a[r[0]].splice(o+1,0,e);break;case"Polygon":a=n.getCoordinates(),a[r[0]].splice(o+1,0,e);break;case"MultiPolygon":a=n.getCoordinates(),a[r[1]][r[0]].splice(o+1,0,e);break;case"LineString":a=n.getCoordinates(),a.splice(o+1,0,e);break;default:return!1}this.setGeometryCoordinates_(n,a);const c=this.rBush_;c.remove(t),this.updateSegmentIndices_(n,o,r,1);const h={segment:[i[0],e],feature:s,geometry:n,depth:r,index:o};c.insert(U(h.segment),h),this.dragSegments_.push([h,1]);const u={segment:[e,i[1]],feature:s,geometry:n,depth:r,index:o+1};return c.insert(U(u.segment),u),this.dragSegments_.push([u,0]),!0}updatePointer_(t){return t&&this.findInsertVerticesAndUpdateDragSegments_(t),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const t=this.vertexFeature_?.getGeometry().getCoordinates();return t?_e(t,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const t=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(U([t])).some(({segment:i})=>st(i[0],t)||st(i[1],t))}removePoint(t){if(t&&(t=X(t,this.getMap().getView().getProjection()),this.updatePointer_(t)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Q.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_.map(([s])=>s));const i=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Si(Ci.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,i}return!1}removeVertex_(){const t=this.dragSegments_,e={};let i=!1,s,n,r,o,a,c,h,u,d,f,g;for(a=t.length-1;a>=0;--a)r=t[a],f=r[0],g=O(f.feature),f.depth&&(g+="-"+f.depth.join("-")),g in e||(e[g]={}),r[1]===0?(e[g].right=f,e[g].index=f.index):r[1]==1&&(e[g].left=f,e[g].index=f.index+1);for(g in e){switch(d=e[g].right,h=e[g].left,c=e[g].index,u=c-1,h!==void 0?f=h:f=d,u<0&&(u=0),o=f.geometry,n=o.getCoordinates(),s=n,i=!1,o.getType()){case"MultiLineString":n[f.depth[0]].length>2&&(n[f.depth[0]].splice(c,1),i=!0);break;case"LineString":n.length>2&&(n.splice(c,1),i=!0);break;case"MultiPolygon":s=s[f.depth[1]];case"Polygon":s=s[f.depth[0]],s.length>4&&(c==s.length-1&&(c=0),s.splice(c,1),i=!0,c===0&&(s.pop(),s.push(s[0]),u=s.length-1));break}if(i){this.setGeometryCoordinates_(o,n);const _=[];if(h!==void 0&&(this.rBush_.remove(h),_.push(h.segment[0])),d!==void 0&&(this.rBush_.remove(d),_.push(d.segment[1])),h!==void 0&&d!==void 0){const m={depth:f.depth,feature:f.feature,geometry:f.geometry,index:u,segment:_};this.rBush_.insert(U(m.segment),m)}this.updateSegmentIndices_(o,c,f.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.length=0}}return i}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const t=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(U([t])).some(({segment:i})=>!(st(i[0],t)||st(i[1],t)))}insertPoint(t){const e=t?X(t,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return e?this.findInsertVerticesAndUpdateDragSegments_(e).reduce((s,n)=>s||this.insertVertex_(n,e),!1):!1}setGeometryCoordinates_(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1}updateSegmentIndices_(t,e,i,s){this.rBush_.forEachInExtent(t.getExtent(),function(n){n.geometry===t&&(i===void 0||n.depth===void 0||xe(n.depth,i))&&n.index>e&&(n.index+=s)})}}function da(l,t){return l.index-t.index}function ws(l,t,e){const i=t.geometry;if(i.getType()==="Circle"){let n=i;if(t.index===de){const r=Mt(n.getCenter(),X(l)),o=Math.sqrt(r)-n.getRadius();return o*o}}const s=X(l);return Ut[0]=X(t.segment[0]),Ut[1]=X(t.segment[1]),wr(s,Ut)}function Ts(l,t,e){const i=t.geometry;if(i.getType()==="Circle"&&t.index===de)return _e(i.getClosestPoint(X(l)));const s=X(l);return Ut[0]=X(t.segment[0]),Ut[1]=X(t.segment[1]),_e(Ys(s,Ut))}function ua(){const l=ji();return function(t,e){return l.Point}}const fa={SELECT:"select"};class ga extends Ce{constructor(t,e,i,s){super(t),this.selected=e,this.deselected=i,this.mapBrowserEvent=s}}const Ne={};class Ui extends Tr{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=t.condition?t.condition:js,this.addCondition_=t.addCondition?t.addCondition:Mi,this.removeCondition_=t.removeCondition?t.removeCondition:Mi,this.toggleCondition_=t.toggleCondition?t.toggleCondition:Bs,this.multi_=t.multi?t.multi:!1,this.filter_=t.filter?t.filter:ge,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.style_=t.style!==void 0?t.style:_a(),this.features_=t.features||new ze;let e;if(t.layers)if(typeof t.layers=="function")e=t.layers;else{const i=t.layers;e=function(s){return i.includes(s)}}else e=ge;this.layerFilter_=e,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(t,e){this.featureLayerAssociation_[O(t)]=e}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(t){return this.featureLayerAssociation_[O(t)]}setHitTolerance(t){this.hitTolerance_=t}setMap(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(t),t?(this.features_.addEventListener(dt.ADD,this.boundAddFeature_),this.features_.addEventListener(dt.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(dt.ADD,this.boundAddFeature_),this.features_.removeEventListener(dt.REMOVE,this.boundRemoveFeature_))}addFeature_(t){const e=t.element;if(this.style_&&this.applySelectedStyle_(e),!this.getLayer(e)){const i=this.getMap().getAllLayers().find(function(s){if(s instanceof Vt&&s.getSource()&&s.getSource().hasFeature(e))return s});i&&this.addFeatureLayerAssociation_(e,i)}}removeFeature_(t){this.style_&&this.restorePreviousStyle_(t.element)}getStyle(){return this.style_}applySelectedStyle_(t){const e=O(t);e in Ne||(Ne[e]=t.getStyle()),t.setStyle(this.style_)}restorePreviousStyle_(t){const e=this.getMap().getInteractions().getArray();for(let s=e.length-1;s>=0;--s){const n=e[s];if(n!==this&&n instanceof Ui&&n.getStyle()&&n.getFeatures().getArray().lastIndexOf(t)!==-1){t.setStyle(n.getStyle());return}}const i=O(t);t.setStyle(Ne[i]),delete Ne[i]}removeFeatureLayerAssociation_(t){delete this.featureLayerAssociation_[O(t)]}handleEvent(t){if(!this.condition_(t))return!0;const e=this.addCondition_(t),i=this.removeCondition_(t),s=this.toggleCondition_(t),n=!e&&!i&&!s,r=t.map,o=this.getFeatures(),a=[],c=[];if(n){Ir(this.featureLayerAssociation_),r.forEachFeatureAtPixel(t.pixel,(h,u)=>{if(!(!(h instanceof H)||!this.filter_(h,u)))return this.addFeatureLayerAssociation_(h,u),c.push(h),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let h=o.getLength()-1;h>=0;--h){const u=o.item(h),d=c.indexOf(u);d>-1?c.splice(d,1):(o.remove(u),a.push(u))}c.length!==0&&o.extend(c)}else{r.forEachFeatureAtPixel(t.pixel,(h,u)=>{if(!(!(h instanceof H)||!this.filter_(h,u)))return(e||s)&&!o.getArray().includes(h)?(this.addFeatureLayerAssociation_(h,u),c.push(h)):(i||s)&&o.getArray().includes(h)&&(a.push(h),this.removeFeatureLayerAssociation_(h)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let h=a.length-1;h>=0;--h)o.remove(a[h]);o.extend(c)}return(c.length>0||a.length>0)&&this.dispatchEvent(new ga(fa.SELECT,c,a,t)),!0}}function _a(){const l=ji();return ot(l.Polygon,l.LineString),ot(l.GeometryCollection,l.LineString),function(t){return t.getGeometry()?l[t.getGeometry().getType()]:null}}const Fi={SNAP:"snap",UNSNAP:"unsnap"};class Ei extends Ce{constructor(t,e){super(t),this.vertex=e.vertex,this.vertexPixel=e.vertexPixel,this.feature=e.feature,this.segment=e.segment}}const bi={Circle(l,t){const i=Rr(l);return bi.Polygon(i)},GeometryCollection(l,t){const e=[],i=l.getGeometriesArray();for(let s=0;s<i.length;++s){const n=bi[i[s].getType()];n&&e.push(n(i[s],t))}return e.flat()},LineString(l){const t=[],e=l.getFlatCoordinates(),i=l.getStride();for(let s=0,n=e.length-i;s<n;s+=i)t.push([e.slice(s,s+2),e.slice(s+i,s+i+2)]);return t},MultiLineString(l){const t=[],e=l.getFlatCoordinates(),i=l.getStride(),s=l.getEnds();let n=0;for(let r=0,o=s.length;r<o;++r){const a=s[r];for(let c=n,h=a-i;c<h;c+=i)t.push([e.slice(c,c+2),e.slice(c+i,c+i+2)]);n=a}return t},MultiPoint(l){const t=[],e=l.getFlatCoordinates(),i=l.getStride();for(let s=0,n=e.length;s<n;s+=i)t.push([e.slice(s,s+2)]);return t},MultiPolygon(l){const t=[],e=l.getFlatCoordinates(),i=l.getStride(),s=l.getEndss();let n=0;for(let r=0,o=s.length;r<o;++r){const a=s[r];for(let c=0,h=a.length;c<h;++c){const u=a[c];for(let d=n,f=u-i;d<f;d+=i)t.push([e.slice(d,d+2),e.slice(d+i,d+i+2)]);n=u}}return t},Point(l){return[[l.getFlatCoordinates().slice(0,2)]]},Polygon(l){const t=[],e=l.getFlatCoordinates(),i=l.getStride(),s=l.getEnds();let n=0;for(let r=0,o=s.length;r<o;++r){const a=s[r];for(let c=n,h=a-i;c<h;c+=i)t.push([e.slice(c,c+2),e.slice(c+i,c+i+2)]);n=a}return t}};function Is(l){return l.feature?l.feature:l.element?l.element:null}const wi=[],yt=[],At=[];class ma extends Bi{constructor(t){t=t||{};const e=t;e.handleDownEvent||(e.handleDownEvent=ge),e.stopDown||(e.stopDown=Ws),super(e),this.on,this.once,this.un,this.source_=t.source?t.source:null,this.vertex_=t.vertex!==void 0?t.vertex:!0,this.edge_=t.edge!==void 0?t.edge:!0,this.intersection_=t.intersection!==void 0?t.intersection:!1,this.features_=t.features?t.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=t.pixelTolerance!==void 0?t.pixelTolerance:10,this.rBush_=new ei,this.snapped_=null,this.segmenters_=Object.assign({},bi,t.segmenters)}addFeature(t,e){e=e!==void 0?e:!0;const i=O(t),s=t.getGeometry();if(s){const n=this.segmenters_[s.getType()];if(n){this.indexedFeaturesExtents_[i]=s.getExtent(Zt());const r=n(s,this.getMap().getView().getProjection());let o=r.length;for(let a=0;a<o;++a){const c=r[a];yt[a]=U(c),At[a]={feature:t,segment:c}}if(yt.length=o,At.length=o,this.intersection_)for(let a=0,c=r.length;a<c;++a){const h=r[a];if(h.length===1)continue;const u=yt[a];for(let f=0,g=r.length;f<g;++f){if(a===f||a-1===f||a+1===f)continue;const _=r[f];if(!nt(u,yt[f]))continue;const m=ds(h,_);if(!m)continue;const y=[m];yt[o]=U(y),At[o++]={feature:t,segment:y,isIntersection:!0}}const d=this.rBush_.getInExtent(yt[a]);for(const{segment:f}of d){if(f.length===1)continue;const g=ds(h,f);if(!g)continue;const _=[g];yt[o]=U(_),At[o++]={feature:t,segment:_,isIntersection:!0}}}o===1?this.rBush_.insert(yt[0],At[0]):this.rBush_.load(yt,At)}}e&&(this.featureChangeListenerKeys_[i]=pt(t,Dt.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t}areSnapDataEqual_(t,e){return t.segment===e.segment&&t.feature===e.feature}handleEvent(t){const e=this.snapTo(t.pixel,t.coordinate,t.map);return e?(t.coordinate=e.vertex.slice(0,2),t.pixel=e.vertexPixel,this.snapped_&&!this.areSnapDataEqual_(this.snapped_,e)&&this.dispatchEvent(new Ei(Fi.UNSNAP,this.snapped_)),this.snapped_={vertex:t.coordinate,vertexPixel:t.pixel,feature:e.feature,segment:e.segment},this.dispatchEvent(new Ei(Fi.SNAP,this.snapped_))):this.snapped_&&(this.dispatchEvent(new Ei(Fi.UNSNAP,this.snapped_)),this.snapped_=null),super.handleEvent(t)}handleFeatureAdd_(t){const e=Is(t);e&&this.addFeature(e)}handleFeatureRemove_(t){const e=Is(t);e&&this.removeFeature(e)}handleFeatureChange_(t){const e=t.target;if(this.handlingDownUpSequence){const i=O(e);i in this.pendingFeatures_||(this.pendingFeatures_[i]=e)}else this.updateFeature_(e)}handleUpEvent(t){const e=Object.values(this.pendingFeatures_);if(e.length)for(const i of e)this.updateFeature_(i);return!1}removeFeature(t,e){const i=e!==void 0?e:!0,s=O(t),n=this.indexedFeaturesExtents_[s];if(n){const r=this.rBush_,o=[];r.forEachInExtent(n,function(a){t===a.feature&&o.push(a)});for(let a=o.length-1;a>=0;--a)r.remove(o[a])}i&&(kt(this.featureChangeListenerKeys_[s]),delete this.featureChangeListenerKeys_[s])}setMap(t){const e=this.getMap(),i=this.featuresListenerKeys_;let s=this.getFeatures_();if(Array.isArray(s)||(s=s.getArray()),e&&(i.forEach(kt),i.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(kt),this.featureChangeListenerKeys_={}),super.setMap(t),t){this.features_?i.push(pt(this.features_,dt.ADD,this.handleFeatureAdd_,this),pt(this.features_,dt.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push(pt(this.source_,V.ADDFEATURE,this.handleFeatureAdd_,this),pt(this.source_,V.REMOVEFEATURE,this.handleFeatureRemove_,this));for(const n of s)this.addFeature(n)}}snapTo(t,e,i){i.getView().getProjection();const s=X(e),n=Wi(Se(U([s]),i.getView().getResolution()*this.pixelTolerance_)),r=this.rBush_.getInExtent(n),o=r.length;if(o===0)return null;let a,c=1/0,h,u=null,d;const f=this.pixelTolerance_*this.pixelTolerance_,g=()=>{if(a){const _=i.getPixelFromCoordinate(a);if(Mt(t,_)<=f&&(d&&this.intersection_||!d&&(this.vertex_||this.edge_)))return{vertex:a,vertexPixel:[Math.round(_[0]),Math.round(_[1])],feature:h,segment:u}}return null};if(this.vertex_||this.intersection_){for(let m=0;m<o;++m){const y=r[m];if(y.feature.getGeometry().getType()!=="Circle")for(const p of y.segment){const C=X(p),x=Mt(s,C);x<c&&(a=p,c=x,h=y.feature,d=y.isIntersection)}}const _=g();if(_)return _}if(this.edge_){for(let m=0;m<o;++m){let y=null;const p=r[m];if(p.feature.getGeometry().getType()==="Circle"){let C=p.feature.getGeometry();y=Pr(s,C)}else{const[C,x]=p.segment;x&&(wi[0]=X(C),wi[1]=X(x),y=Ys(s,wi))}if(y){const C=Mt(s,y);C<c&&(a=_e(y),u=p.feature.getGeometry().getType()==="Circle"?null:p.segment,c=C,h=p.feature)}}const _=g();if(_)return _}return null}updateFeature_(t){this.removeFeature(t,!1),this.addFeature(t,!1)}}function ya(l){const t=new le({color:l.get("COLOR")||"#eeeeee55"}),e=new Ye({color:"rgba(255, 255, 255, 0.75)",width:2});return new Xe({fill:t,stroke:e})}function pa(l,t){const e=new Ui({condition:kr,style:ya});return l.addInteraction(e),e.on("select",function(i){t.value=i.selected}),e}function xa(l,t){const i=pa(l,t).getFeatures(),s=new vr({condition:Lr});l.addInteraction(s),s.on("boxstart",function(){i.clear(),t.value=[]}),s.on("boxend",function(){let n=[];const r=s.getGeometry().getExtent(),o=l.getView().getProjection().getExtent(),a=Nt(o),c=Math.floor((r[0]-o[0])/a),h=Math.floor((r[2]-o[0])/a),u=l.getLayers();for(let d=c;d<=h;++d){const f=Math.max(r[0]-d*a,o[0]),g=Math.min(r[2]-d*a,o[2]),_=[f,r[1],g,r[3]];u.forEach(m=>{if(m.getSource&&m.getSource().getFeaturesInExtent){const y=m.getSource().getFeaturesInExtent(_).filter(p=>!n.includes(p)&&p.getGeometry().intersectsExtent(_));n=[...n,...y]}})}i.extend(n),t.value=n})}const Ca={class:"hello-world"},Sa={class:"layer-control"},Fa={class:"layer-item"},Ea={class:"layer-item"},wa={class:"layer-item"},Ta={class:"view-info"},Ia={class:"feature-info"},Pa={class:"draw-toolbar"},Ra={class:"tool-buttons"},va={key:0,src:Yr,class:"china-flag-popup",alt:""},La={__name:"index",setup(l){const t=Pt(null);let e=null;const i=Pt(!1),s=Pt(""),n=Pt(!1),r=Pt([]),o=Pt("None");let a,c;const h=Pt({amap:!0,ecoregions:!1,hnxj:!1});let u=[],d=null,f=null,g=null;function _(){const S=new ce({url:"/data/ecoregions.json",format:new Po});return new Vt({source:S,style:function(F){const w=F.get("COLOR")||"#888888";return new Xe({stroke:new Ye({color:w,width:1}),fill:new le({color:w+"40"})})},visible:!1})}function m(){const S=new ce({url:"/data/hnxj_ll_esri.json",format:new Uo});return new Vt({source:S,style:new Xe({stroke:new Ye({color:"rgba(255, 0, 0, 0.8)",width:2}),fill:new le({color:"rgba(255, 0, 0, 0.1)"})}),visible:!1})}function y(){return new Vt({source:new ce,style:new Xe({fill:new le({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Ye({color:"#ffcc33",width:3}),image:new Br({radius:7,fill:new le({color:"#ffcc33"})})})})}function p(S){S==="amap"?u.forEach(F=>{F.setVisible(h.value.amap)}):S==="ecoregions"&&d?d.setVisible(h.value.ecoregions):S==="hnxj"&&f&&f.setVisible(h.value.hnxj)}fn(()=>{const S=Mr({}).extend([new Dr({extent:[...ae([80,2]),...ae([135,55])],label:"",tipLabel:"",className:"zoom-to-china"}),new Gr,new br,new Or({projection:"EPSG:4326",className:"mouse-position",coordinateFormat:function(F){if(!F)return"";const w=F[0].toFixed(4),L=F[1].toFixed(4);return`: ${w} | : ${L}`}})]);e=new Ar({center:ae([112,28.5]),zoom:5}),u=Nr(),d=_(),f=m(),g=y(),t.value=new Wr({target:"idmap",loadTilesWhileInteracting:!0,layers:[...u,d,f,g],view:e,controls:S}),setTimeout(()=>{const F=document.querySelector(".zoom-to-china button");F&&F.addEventListener("click",()=>{i.value=!0,setTimeout(()=>{i.value=!1},800)})},100),xa(t.value,r),t.value.addInteraction(new ca({source:g.getSource()})),D()});function C(){if(t.value){const S=t.value.getView();S.setZoom(Math.min(S.getZoom()+1,19))}}function x(){if(t.value){const S=t.value.getView();S.setZoom(Math.max(S.getZoom()-1,1))}}function T(){if(t.value){const S=t.value.getView();S.setCenter(ae([112,27])),S.setZoom(7)}}function P(){if(t.value){const S=t.value.getView();S.setCenter(ae([112.9598,28.21])),S.setZoom(10)}}function R(){const S=e.getZoom().toFixed(2),F=jr(e.getCenter()),w=F[0].toFixed(4),L=F[1].toFixed(4);s.value=`ZOOM ${S}, [${w}, ${L}]`}function k(){n.value=!n.value,n.value?(e.on("change",R),R()):(e.un("change",R),s.value="")}const v=gn(()=>{let S=r.value.length;if(S==1){const F=r.value[0];return F.get("ECO_NAME")||F.get("NAME")||F.get("name")||"1"}else return S>1?`${S}`:"Ctrl+"});function A(S){console.log(":",S),o.value=S,D()}function D(){if(console.log(":",o.value),M(a),M(c),a=c=void 0,o.value!=="None"&&g&&t.value){const S=g.getSource();a=new aa({source:S,type:o.value}),c=new ma({source:S}),t.value.addInteraction(a),t.value.addInteraction(c),console.log("")}}function M(S){if(!S)return;const F=t.value.getInteractions(),w=F.getArray();for(let L=w.length-1;L>=0;--L)if(S.ol_uid==w[L].ol_uid)return F.removeAt(L)}function G(){g&&g.getSource().clear()}return(S,F)=>(rs(),ns("div",Ca,[N("div",{class:"map-tools"},[N("a",{onClick:C},""),N("a",{onClick:x},""),N("a",{onClick:T},""),N("a",{onClick:P},"")]),N("div",Sa,[F[14]||(F[14]=N("div",{class:"control-title"},"",-1)),N("div",Fa,[N("label",null,[ui(N("input",{type:"checkbox","onUpdate:modelValue":F[0]||(F[0]=w=>h.value.amap=w),onChange:F[1]||(F[1]=w=>p("amap"))},null,544),[[fi,h.value.amap]]),F[11]||(F[11]=ve("  ",-1))])]),N("div",Ea,[N("label",null,[ui(N("input",{type:"checkbox","onUpdate:modelValue":F[2]||(F[2]=w=>h.value.ecoregions=w),onChange:F[3]||(F[3]=w=>p("ecoregions"))},null,544),[[fi,h.value.ecoregions]]),F[12]||(F[12]=ve("  ",-1))])]),N("div",wa,[N("label",null,[ui(N("input",{type:"checkbox","onUpdate:modelValue":F[4]||(F[4]=w=>h.value.hnxj=w),onChange:F[5]||(F[5]=w=>p("hnxj"))},null,544),[[fi,h.value.hnxj]]),F[13]||(F[13]=ve("  ",-1))])])]),N("div",Ta,[ve(" "+gi(s.value)+" ",1),N("a",{onClick:k},gi(n.value?"":""),1)]),N("div",Ia,gi(v.value),1),N("div",Pa,[F[15]||(F[15]=N("div",{class:"toolbar-title"},"",-1)),N("div",Ra,[N("button",{class:re(["tool-btn",{active:o.value==="None"}]),onClick:F[6]||(F[6]=w=>A("None")),title:""},"  ",2),N("button",{class:re(["tool-btn",{active:o.value==="Point"}]),onClick:F[7]||(F[7]=w=>A("Point")),title:""},"  ",2),N("button",{class:re(["tool-btn",{active:o.value==="LineString"}]),onClick:F[8]||(F[8]=w=>A("LineString")),title:""},"  ",2),N("button",{class:re(["tool-btn",{active:o.value==="Polygon"}]),onClick:F[9]||(F[9]=w=>A("Polygon")),title:""},"  ",2),N("button",{class:re(["tool-btn",{active:o.value==="Circle"}]),onClick:F[10]||(F[10]=w=>A("Circle")),title:""},"  ",2),N("button",{class:"tool-btn clear-btn",onClick:G,title:""},"  ")])]),_n(yn,{name:"flag-pop"},{default:mn(()=>[i.value?(rs(),ns("img",va)):pn("",!0)]),_:1}),F[16]||(F[16]=N("div",{class:"map-container",id:"idmap"},null,-1))]))}},Da=un(La,[["__scopeId","data-v-f469eb11"]]);export{Da as default};
//# sourceMappingURL=index-5Up9-7gN.js.map
